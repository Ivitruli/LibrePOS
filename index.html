<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com https://cdnjs.cloudflare.com data: blob:;">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LibrePOS - Gesti√≥n Almac√©n</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Mono:wght@400;500&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
<script src="node_modules/jsbarcode/dist/JsBarcode.all.min.js"></script>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<header>
  <div class="header-brand">
    <img id="header-logo" class="header-logo" src="" alt="Logo">
    <h1 id="header-title">Libre<span>POS</span></h1>
  </div>
  <nav class="nav-tabs">
    <button class="nav-tab active" onclick="showSection('pos',this)">üõí POS</button>
    <button class="nav-tab" onclick="showSection('compras',this)">üì• Compras</button>
    <button class="nav-tab" id="tab-stock" onclick="showSection('stock',this)">üì¶ Stock</button>
    <button class="nav-tab" onclick="showSection('ventas',this)">üßæ Ventas</button>
    <button class="nav-tab" onclick="showSection('proveedores',this)">üöö Prov.</button>
    <button class="nav-tab" onclick="showSection('gastos',this)">üí∏ Gastos</button>
    <button class="nav-tab" onclick="showSection('finanzas',this)">üìà Finanzas</button>
    <button class="nav-tab" onclick="showSection('socios',this)">ü§ù Socios</button>
    <button class="nav-tab" onclick="showSection('clientes',this)">üë• Clientes</button>
    <button class="nav-tab" onclick="showSection('indicadores',this)">üìä Indicadores</button>
    <button class="nav-tab" onclick="showSection('informes',this)">üìÅ Informes</button>
    <button class="nav-tab" onclick="showSection('config',this)">‚öôÔ∏è Config</button>
  </nav>
</header>
<main>

<section class="section active" id="sec-pos">
  <div id="alertas-venc-pos"></div>
  <div class="pos-layout">
    <div style="display:flex; flex-direction:column; gap:1rem;">
      <div class="card" style="padding-bottom: 0.5rem;">
        <div style="font-size:.73rem;color:var(--muted);margin-bottom:.5rem;font-weight:600;text-transform:uppercase;">‚≠ê Combos y Promociones Activas</div>
        <div id="pos-promos-container" style="display:flex; gap:10px; overflow-x:auto; padding-bottom:10px;">
           <span style="font-size:.8rem;color:var(--muted);">No hay promociones activas. Cre√°las en el men√∫ Ventas.</span>
        </div>
      </div>

      <div class="card">
        <div class="barcode-wrap">
          <input type="text" id="pos-barcode" placeholder="Esperando c√≥digo... (o ENTER para confirmar venta)" oninput="handleBarcodeInput()" autofocus>
        </div>
        <div style="font-size:.73rem;color:var(--muted);margin-bottom:.65rem;font-weight:600;">‚Üë Lectora de c√≥digo ¬∑ O busc√° por nombre:</div>
        <input type="text" id="pos-search" placeholder="Buscar por nombre o marca..." oninput="filterProducts()" style="margin-bottom:.85rem;">
        <div class="product-grid" id="product-grid"></div>
      </div>
    </div>
    <div class="cart-panel">
      <div class="cart-header">üõí Venta actual</div>
      <div class="cart-items" id="cart-items"><div style="padding:2rem 1rem;text-align:center;color:var(--muted);font-size:.82rem;">Seleccion√° productos</div></div>
      <div class="cart-footer">
        
        <div style="display:flex;align-items:center;gap:.4rem;margin-bottom:.8rem;background:var(--surface2);padding:.4rem;border-radius:5px;">
          <input type="checkbox" id="cart-venta-costo" onchange="toggleCartCosto()"> 
          <label for="cart-venta-costo" style="color:var(--ink);cursor:pointer;margin:0;">Aplicar Venta al Costo a todo el carrito</label>
        </div>
        
        <div style="font-size:.69rem;font-weight:600;text-transform:uppercase;color:var(--muted);margin-bottom:.38rem;">Medio de pago</div>
        <div class="medios-pago" id="medios-pago-btns"></div>
        <div id="cart-desc-row" style="background:var(--green-light);border:1px solid var(--green);border-radius:5px;padding:.42rem .72rem;margin-bottom:.6rem;font-size:.78rem;color:var(--green);display:none;font-weight:600;"></div>
        
        <div style="margin-top: 10px; margin-bottom: 10px; padding: 10px; background: rgba(196,67,42,0.1); border: 1px dashed var(--accent); border-radius: 5px;">
            <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 5px;">
                <input type="checkbox" id="chkCtaCte" onchange="document.getElementById('pos-cliente-wrap').style.display = this.checked ? 'block' : 'none'; uiActualizarTotalPOS();">
                <label for="chkCtaCte" style="margin: 0; font-weight: bold; color: var(--accent); cursor: pointer;">Vender a Cuenta Corriente (Fiado)</label>
            </div>
            <div id="pos-cliente-wrap" style="display: none;">
                <select id="pos-cliente" style="width: 100%; margin-top: 5px;"></select>
            </div>
        </div>
        
        <div style="margin-top: 10px; margin-bottom: 15px; border-top: 1px dashed var(--border); padding-top: 15px; display: flex; flex-direction: column; gap: 12px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <span style="font-size: .85rem; font-weight: 600; color: var(--accent);">Descuento manual ($)</span>
                <input type="number" id="pos-desc-manual" class="edit-inline" style="width: 80px; text-align: right;" oninput="window.uiAplicarDescuentoManual()" placeholder="0.00" min="0">
            </div>

            <div style="display: flex; justify-content: space-between; align-items: center;">
                <button id="btnRedondeo" class="btn btn-sm btn-secondary" onclick="uiAplicarRedondeo()">Redondear (Sug: $0)</button>
                <span id="lblDescuentoAplicado" class="mono" style="color: var(--accent); font-weight: bold;">-$0.00</span>
            </div>

            <div style="display: flex; align-items: center; justify-content: space-between;">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <input type="checkbox" id="chkEnvio" onchange="uiActualizarTotalPOS()">
                    <label for="chkEnvio" style="margin: 0; font-size: .85rem;">Env√≠o a dom.</label>
                </div>
                <input type="number" id="inputCostoEnvio" class="edit-inline" style="display: none; width: 80px;" oninput="uiActualizarTotalPOS()" placeholder="Costo $">
            </div>
        </div>

        <div class="cart-totales">
          <div class="cart-total-row" id="cart-total-sin-desc-row" style="display:none;">
            <span style="font-size:.72rem;text-transform:uppercase;color:var(--muted);font-weight:600;">Sin descuento</span>
            <span class="mono" id="cart-total-sin-desc" style="font-size:1rem;color:var(--muted);text-decoration:line-through;"></span>
          </div>
          <div class="cart-total-row" style="border-top: 2px solid var(--ink); padding-top: 10px;">
            <span style="font-size:.72rem;text-transform:uppercase;color:var(--muted);font-weight:600;" id="cart-total-label">Total</span>
            <span class="cart-total-amount" id="cart-total">$0</span>
          </div>
        </div>
        
        <button class="btn btn-green" style="width:100%;font-size:.95rem;padding:.82rem;margin-top:15px;" onclick="confirmarVenta()">Confirmar venta (Enter)</button>
        <button class="btn btn-secondary" style="width:100%;margin-top:.42rem;" onclick="limpiarCarrito()">Cancelar</button>
      </div>
    </div>
  </div>
</section>

<section class="section" id="sec-clientes">
  <div class="card">
    <div class="card-title">Nuevo Cliente (Cuenta Corriente)</div>
    <div class="form-grid">
      <div class="form-group"><label>Nombre / Raz√≥n Social *</label><input type="text" id="cli-nombre"></div>
      <div class="form-group"><label>Tel√©fono</label><input type="text" id="cli-tel"></div>
      <div class="form-group"><label>Direcci√≥n</label><input type="text" id="cli-dir"></div>
      <div class="form-group"><label>L√≠mite de Cr√©dito ($)</label><input type="number" id="cli-limite" step="1000" min="0" placeholder="0 = Ilimitado"></div>
    </div>
    <div class="info-tooltip">Establec√© un l√≠mite de cr√©dito para evitar que el cliente acumule una deuda mayor a la permitida. Dej√° en 0 para cr√©dito ilimitado.</div>
    <div style="margin-top:1rem;"><button class="btn btn-primary" onclick="agregarCliente()">Agregar Cliente</button></div>
  </div>
  <div class="card">
    <div class="card-title">Directorio de Clientes y Estado de Cuentas</div>
    <div id="tabla-clientes-container"></div>
  </div>
</section>

<section class="section" id="sec-compras">
  <div class="card">
    <div class="card-title">1. Datos del Comprobante / Remito</div>
    <div class="form-grid">
      <div class="form-group"><label>Proveedor *</label><select id="comp-proveedor"></select></div>
      <div class="form-group"><label>N¬∫ Comprobante / Detalle</label><input type="text" id="comp-comprobante" placeholder="Ej: Factura A 0001-1234"></div>
      <div class="form-group"><label>Fecha *</label><input type="date" id="comp-fecha"></div>
      <div class="form-group"><label>Estado del Pago</label>
        <select id="comp-pago" onchange="togglePagoCompra(this.value)"><option value="pagado">Pagado ahora</option><option value="adeudado">A cuenta (Deuda)</option></select>
      </div>
      <div class="form-group" id="comp-cuenta-wrap"><label>Pagado desde cuenta</label><select id="comp-cuenta"></select></div>
    </div>
  </div>

  <div class="card">
    <div class="card-title">2. Agregar Productos al Comprobante</div>
    <div class="form-grid">
      <div class="form-group">
        <label>C√≥digo de barras / interno *</label>
        <div style="display:flex;gap:5px;">
          <input type="text" id="comp-barcode" placeholder="Escane√° o escrib√≠" onblur="buscarProdCompra()">
          <button class="btn btn-secondary" onclick="document.getElementById('comp-barcode').value = compras.generarCodigoInterno(); buscarProdCompra();" title="Generar c√≥digo interno autom√°tico">‚öôÔ∏è</button>
        </div>
      </div>
      <div class="form-group"><label>Producto (autocompletado)</label><input type="text" id="comp-prod-nombre" readonly style="background:var(--surface2);" placeholder="‚Äî"><input type="hidden" id="comp-prod-id"></div>
      <div class="form-group"><label>Cantidad *</label><input type="number" id="comp-cantidad" step="0.001" min="0" placeholder="0"></div>
      <div class="form-group"><label>Costo unitario ($) *</label><input type="number" id="comp-costo" step="0.01" min="0" placeholder="0.00"></div>
      <div class="form-group"><label>Vencimiento</label><input type="date" id="comp-venc"></div>
    </div>
    
    <div style="margin-top:1rem; text-align:right;">
      <button class="btn btn-secondary" onclick="agregarItemRemito()">+ A√±adir al listado</button>
    </div>

    <table style="margin-top:15px;">
      <thead><tr><th>C√≥digo</th><th>Producto</th><th>Cant.</th><th>Costo U.</th><th>Subtotal</th><th>Venc.</th><th></th></tr></thead>
      <tbody id="tabla-remito-items"></tbody>
    </table>

    <div style="margin-top:1.5rem; padding-top:1rem; border-top:2px solid var(--border); display:flex; justify-content:space-between; align-items:center;">
      <div style="font-size:1.2rem; font-weight:bold;">Total Remito: <span class="mono" id="comp-total-remito">$0.00</span></div>
      <button class="btn btn-primary" onclick="confirmarRemitoCompleto()">Registrar Compra y Actualizar Stock</button>
    </div>
  </div>
</section>

<section class="section" id="sec-stock">
  <div id="alertas-venc-stock"></div>
  <div class="card">
    <div class="card-title">Reglas de precios globales</div>
    <div style="display:flex;gap:.85rem;align-items:flex-end;flex-wrap:wrap;">
      <div class="form-group"><label>Descuento por pago en Efectivo (%)</label><input type="number" id="cfg-desc-efectivo" step="0.5" min="0" max="50" placeholder="10" value="10"></div>
      <button class="btn btn-primary" onclick="guardarDescEfectivo()">Guardar regla</button>
    </div>
    <div class="info-tooltip">Se aplica en POS al elegir Efectivo. Productos con "Venta al Costo", "Promociones/Combos" o "‚àíDesc%" propio en la tabla de abajo NO reciben este descuento extra.</div>
  </div>
  
  <div class="card">
    <div class="card-title">Cat√°logo ‚Äî Modificaci√≥n y Precios</div>
    
    <div style="display:flex;gap:.5rem;margin-bottom:.95rem; align-items:center; flex-wrap:wrap;">
      <input type="text" id="stock-search" placeholder="üîç Buscar por nombre, marca, c√≥digo..." oninput="renderTablaProductos()" style="flex:1; min-width:200px;">
      <select id="stock-sort" onchange="renderTablaProductos()" style="max-width:200px;">
         <option value="nombre">Ordenar por Nombre</option>
         <option value="venc">Ordenar por Vencimiento</option>
         <option value="prov">Ordenar por Proveedor</option>
      </select>
      <button class="btn btn-amber" onclick="abrirModalPreciosDesactualizados()">‚ö†Ô∏è Revisar Precios en G√≥ndola</button>
    </div>
    
    <div style="overflow-x:auto;">
    <table id="tabla-stock-cat">
      <thead><tr>
        <th>C√≥digo</th><th>Nombre</th><th>Unidad</th><th>Stock Min.</th>
        <th>Stock Real</th><th>Costo Alto</th><th>+Fijo$</th><th>+Imp%</th><th>+Gan%</th><th>‚àíDesc%</th>
        <th title="Ignora ganancia y descuento">Al Costo</th><th>Precio final</th>
        <th>Acciones</th>
      </tr></thead>
      <tbody id="tabla-productos"></tbody>
    </table>
    </div>
    
    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:.75rem; flex-wrap:wrap; gap:.5rem;">
      <div style="display:flex; gap:.5rem;">
        <button class="btn btn-blue" onclick="abrirRetiroSocio()">üì¶ Retiro de Socios</button>
        <button class="btn btn-purple" onclick="abrirModalMuestras()">üéÅ Muestras/Sorteos</button>
        <button class="btn btn-primary" onclick="window.abrirModalAuditoria()">‚öñÔ∏è Auditor√≠a / Ajuste</button>
        <button class="btn btn-secondary" onclick="imprimirCodigosBarra()">üñ®Ô∏è C√≥digos de Barras</button>
      </div>
      <button class="btn btn-green" onclick="guardarPreciosTodos()">üíæ Guardar cambios de precios</button>
    </div>
  </div>
</section>

<section class="section" id="sec-ventas">
  <div class="tabs-row">
    <button class="tab-pill active" onclick="showVentTab('list',this)">Historial de Ventas</button>
    <button class="tab-pill" onclick="showVentTab('promo',this)">Combos y Promociones</button>
  </div>

  <div id="vent-list" class="vent-tab active">
    <div class="card">
      <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; margin-bottom:1rem;">
        <div class="card-title" style="margin:0;">Listado de ventas</div>
        <button class="btn btn-primary btn-sm" onclick="window.abrirModalVentaHistorica()">‚è≥ + Cargar Venta Atrasada</button>
      </div>
      
      <div style="display:flex;gap:.5rem;flex-wrap:wrap;align-items:center;margin-bottom:.9rem;">
        <input type="date" id="vent-f-desde" style="max-width:150px;"> <input type="date" id="vent-f-hasta" style="max-width:150px;">
        <select id="vent-filtro-medio" style="max-width:165px;"><option value="">Todos los medios</option></select>
        <select id="vent-filtro-fact" style="max-width:165px;"><option value="">Todas</option><option value="si">Facturadas</option><option value="no">Sin facturar</option></select>
        <button class="btn btn-secondary btn-sm" onclick="renderTablaVentas()">Filtrar</button>
      </div>
      <table>
        <thead><tr><th>Fecha/Hora</th><th>Productos</th><th>Total</th><th>Desc. ef.</th><th>Medio</th><th>Facturada</th></tr></thead>
        <tbody id="tabla-ventas-menu"></tbody>
      </table>
      <div id="ventas-resumen-row" style="text-align:right;padding:.7rem;font-family:'DM Mono',monospace;font-weight:600;"></div>
    </div>
  </div>

  <div id="vent-promo" class="vent-tab" style="display:none;">
    <div class="card" style="border-left: 4px solid var(--green);">
      <div style="display:flex; justify-content:space-between; align-items:center;">
          <div class="card-title" style="margin:0; border:none;">Mis Promociones Activas</div>
          <button class="btn btn-green" onclick="window.abrirModalNuevaPromo()">+ Crear Promo Manual</button>
      </div>
      <div class="info-tooltip" style="margin-top:1rem;">Las promociones creadas aqu√≠ aparecer√°n como botones r√°pidos en la Caja Registradora (POS). No reciben el descuento general en efectivo para proteger la rentabilidad.</div>
      <div id="lista-promos-activas" style="margin-top:1.5rem; display:grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap:1rem;"></div>
    </div>

    <div class="card">
      <div class="card-title">Sugerencias del Algoritmo (Market Basket Analysis)</div>
      <div class="info-tooltip">Calcula agrupaciones de productos que se venden juntos con mayor frecuencia. Te sugiere un descuento inteligente garantizando que el combo siempre genere una ganancia m√≠nima del 10% sobre los costos, y evitando que sea m√°s barato comprarlo por separado en efectivo.</div>
      <div style="margin-top:.85rem;margin-bottom:1rem;">
         <button class="btn btn-primary" onclick="generarAnalisisPromociones()">Ejecutar An√°lisis y Mostrar Sugerencias</button>
      </div>
      <table>
        <thead><tr><th>Combinaci√≥n Sugerida</th><th>Ventas Conjuntas</th><th>Precio Recomendado</th><th></th></tr></thead>
        <tbody id="tabla-promociones"><tr><td colspan="4" style="text-align:center;color:var(--muted)">Ejecut√° el an√°lisis para ver el Top 10.</td></tr></tbody>
      </table>
    </div>
  </div>
</section>

<section class="section" id="sec-proveedores">
  <div class="tabs-row">
    <button class="tab-pill active" onclick="showProvTab('list',this)">Directorio de Proveedores</button>
    <button class="tab-pill" onclick="showProvTab('deudas',this)">Cuentas por Pagar (Deudas)</button>
  </div>
  
  <div id="prov-list" class="prov-tab">
    <div class="card">
      <div class="card-title">Nuevo proveedor</div>
      <div class="form-grid">
        <div class="form-group"><label>Nombre *</label><input type="text" id="prov-nombre"></div>
        <div class="form-group"><label>Contacto</label><input type="text" id="prov-contacto"></div>
        <div class="form-group"><label>Tel√©fono</label><input type="text" id="prov-tel"></div>
        <div class="form-group"><label>D√≠as de Pedido</label>
          <select id="prov-dias-pedido" multiple style="height:70px;padding:.2rem;"><option value="1">Lunes</option><option value="2">Martes</option><option value="3">Mi√©rcoles</option><option value="4">Jueves</option><option value="5">Viernes</option><option value="6">S√°bado</option></select>
        </div>
        <div class="form-group"><label>D√≠as de Entrega</label>
          <select id="prov-dias-entrega" multiple style="height:70px;padding:.2rem;"><option value="1">Lunes</option><option value="2">Martes</option><option value="3">Mi√©rcoles</option><option value="4">Jueves</option><option value="5">Viernes</option><option value="6">S√°bado</option></select>
        </div>
      </div>
      <div class="info-tooltip">Manten√© presionado CTRL (o CMD en Mac) para seleccionar varios d√≠as.</div>
      <div style="margin-top:.95rem;"><button class="btn btn-primary" onclick="agregarProveedor()">Agregar proveedor</button></div>
    </div>
    <div class="card"><div class="card-title">Proveedores registrados</div><div id="tabla-proveedores-container"></div></div>
  </div>

  <div id="prov-deudas" class="prov-tab" style="display:none;">
    <div class="card">
      <div class="card-title">Registrar deuda manual a proveedor</div>
      <div class="form-grid">
        <div class="form-group"><label>Proveedor *</label><select id="deuda-prov"></select></div>
        <div class="form-group"><label>Fecha *</label><input type="date" id="deuda-fecha"></div>
        <div class="form-group"><label>Monto a deber ($) *</label><input type="number" id="deuda-monto" step="0.01" min="0"></div>
        <div class="form-group"><label>Descripci√≥n</label><input type="text" id="deuda-desc" placeholder="Ej: Saldo factura A-001"></div>
        <div class="form-group" style="justify-content:flex-end;"><button class="btn btn-primary" onclick="registrarDeuda()">Registrar Deuda</button></div>
      </div>
    </div>
    <div class="card">
      <div class="card-title">Deudas Pendientes (Pasivos)</div>
      <table><thead><tr><th>Fecha</th><th>Proveedor</th><th>Descripci√≥n</th><th>Monto Original</th><th>Falta Pagar</th><th>Pagar Ahora</th></tr></thead>
      <tbody id="tabla-deudas"></tbody></table>
    </div>
  </div>
</section>

<section class="section" id="sec-gastos">
  <div class="card" style="margin-bottom: 1rem; border-left: 4px solid var(--accent);">
    <div class="card-title">Log√≠stica: Env√≠os Pendientes (Cadeter√≠a)</div>
    <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:1rem;">
       <div style="font-size:1.2rem; font-weight:bold;">Acumulado a pagar: <span id="envios-pendientes-total" class="mono" style="color:var(--accent);">$0.00</span></div>
       <div style="display:flex; gap:10px; align-items:center;">
          <select id="envios-cuenta"></select>
          <button class="btn btn-primary" onclick="pagarCadete()">Liquidar a Cadete</button>
       </div>
    </div>
  </div>

  <div class="card">
    <div class="card-title">Registrar gasto</div>
    <div class="form-grid">
      <div class="form-group"><label>Fecha *</label><input type="date" id="gasto-fecha"></div>
      <div class="form-group"><label>Categor√≠a *</label>
        <select id="gasto-cat"><option>Mercader√≠a no inventariable</option><option>Servicios (luz/gas)</option><option>Alquiler</option><option>Sueldos</option><option>Impuestos/Monotributo</option><option>Mantenimiento</option><option>Retiro Mercader√≠a</option><option>Otros</option></select>
      </div>
      <div class="form-group"><label>Tipo de Gasto</label>
        <select id="gasto-tipo"><option value="variable">Gasto Variable</option><option value="fijo">Gasto Fijo</option></select>
      </div>
      <div class="form-group"><label>Importe ($) *</label><input type="number" id="gasto-importe" step="0.01" min="0"></div>
      <div class="form-group"><label>Pagado desde cuenta *</label><select id="gasto-cuenta"></select></div>
      <div class="form-group"><label>Descripci√≥n</label><input type="text" id="gasto-desc"></div>
    </div>
    <div style="margin-top:1rem;"><button class="btn btn-primary" onclick="registrarGasto()">Registrar gasto</button></div>
  </div>
  <div class="card">
    <div class="card-title">Historial de gastos</div>
    <table><thead><tr><th>Fecha</th><th>Categor√≠a</th><th>Tipo</th><th>Descripci√≥n</th><th>Importe</th><th>Cuenta</th><th></th></tr></thead>
    <tbody id="tabla-gastos"></tbody></table>
  </div>
</section>

<section class="section" id="sec-finanzas">
  <div class="stat-grid">
    <div class="stat-card"><div class="stat-label">Capital Propio</div><div class="stat-value" id="fin-capital">...</div><div class="stat-sub">Patrimonio Neto ‚àí Ganancias</div></div>
    <div class="stat-card" style="border-left-color:var(--green);"><div class="stat-label">Ganancia Sin Asignar</div><div class="stat-value" style="color:var(--green)" id="fin-ganancia">...</div><div class="stat-sub">Disponible para reinvertir o asignar a socios</div></div>
    <div class="stat-card" style="border-left-color:var(--ink);"><div class="stat-label">Liquidez Total</div><div class="stat-value" id="fin-liquidez">...</div><div class="stat-sub">Dinero real en todas las cuentas</div></div>
  </div>
  
  <div class="card">
    <div class="card-title">Cuentas y Medios de Pago (Ajuste de Caja)</div>
    <div class="info-tooltip" style="margin-bottom:1rem;">El <strong>Saldo Sistema</strong> se calcula autom√°ticamente. Si contaste la plata y hay diferencia, ingres√° el <strong>Saldo Real</strong> y ajust√° para crear un asiento contable autom√°tico.</div>
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1rem;" id="lista-cuentas"></div>
    <div style="margin-top:1.5rem;padding-top:1rem;border-top:1px solid var(--border);">
      <h4 style="font-size:.9rem;margin-bottom:.5rem;">Crear nueva cuenta</h4>
      <div style="display:flex;gap:.5rem;">
        <input type="text" id="nueva-cta-nombre" placeholder="Ej: Banco Galicia" style="max-width:200px;">
        <input type="number" id="nueva-cta-saldo" placeholder="Saldo inicial ($)" style="max-width:150px;">
        <button class="btn btn-secondary" onclick="crearCuenta()">A√±adir Cuenta</button>
      </div>
    </div>
  </div>
  
  <div class="card">
    <div class="card-title">üîÑ Transferencia entre Cuentas</div>
    <div class="form-grid">
      <div class="form-group"><label>Cuenta de Origen *</label><select id="transf-origen"></select></div>
      <div class="form-group"><label>Cuenta de Destino *</label><select id="transf-destino"></select></div>
      <div class="form-group"><label>Monto a transferir ($) *</label><input type="number" id="transf-monto" step="0.01" min="0.01"></div>
      <div class="form-group"><label>Fecha *</label><input type="date" id="transf-fecha"></div>
    </div>
    <div style="margin-top:1rem;">
      <button class="btn btn-blue" onclick="registrarTransferencia()">Registrar Movimiento</button>
    </div>
  </div>

  <div class="card"><div class="card-title">Cashflow Semanal (√öltimos 30 d√≠as)</div><div class="chart-container"><canvas id="chart-cashflow"></canvas></div></div>
</section>

<section class="section" id="sec-socios">
  <div class="stat-grid">
    <div class="stat-card"><div class="stat-label">Ganancia Neta Global</div><div class="stat-value mono" id="soc-neta">...</div><div class="stat-sub">Rendimiento Hist√≥rico</div></div>
    <div class="stat-card" style="border-left-color:var(--amber);"><div class="stat-label">Ganancia Sin Asignar</div><div class="stat-value mono" style="color:var(--amber)" id="soc-disp">...</div><div class="stat-sub">Fondos libres de la empresa</div></div>
  </div>
  <div class="card">
    <div class="card-title">Socios y Cuentas Particulares</div>
    <div style="display:flex;gap:.5rem;align-items:flex-end;margin-bottom:.95rem;">
      <div class="form-group"><label>Nombre</label><input type="text" id="socio-nombre"></div>
      <div class="form-group"><label>DNI / CUIT</label><input type="text" id="socio-dni" placeholder="Sin puntos"></div>
      <button class="btn btn-primary" onclick="agregarSocio()">Crear Socio</button>
    </div>
    <div id="lista-socios"></div>
  </div>
  
  <div class="card">
    <div class="card-title">Operaciones de Socios (Libro Diario)</div>
    <div class="form-grid">
      <div class="form-group"><label>Socio *</label><select id="mov-socio"></select></div>
      <div class="form-group"><label>Operaci√≥n Contable *</label>
        <select id="mov-tipo" onchange="document.getElementById('mov-cuenta-wrap').style.display=(this.value==='asignacion'||this.value==='reinversion')?'none':'flex'">
          <option value="deposito">üì• Dep√≥sito de Capital (Socio aporta dinero a la empresa)</option>
          <option value="asignacion">üìä Asignar Ganancia (Pasar utilidades al saldo personal del socio)</option>
          <option value="retiro">üì§ Retirar Fondos / Pr√©stamo (Puede quedar en negativo si extrae de m√°s)</option>
          <option value="reinversion">‚ôªÔ∏è Reinvertir Utilidades (Pasa Ganancia libre a Capital Propio General)</option>
        </select>
      </div>
      <div class="form-group"><label>Monto ($) *</label><input type="number" id="mov-importe" step="0.01"></div>
      <div class="form-group" id="mov-cuenta-wrap"><label>Cuenta Bancaria/Caja afectada</label><select id="mov-cuenta"></select></div>
      <div class="form-group"><label>Fecha</label><input type="date" id="mov-fecha"></div>
    </div>
    <div class="info-tooltip">Para <strong>Reinvertir utilidades</strong>, no es necesario seleccionar a un socio en particular.</div>
    <div style="margin-top:1rem;"><button class="btn btn-primary" onclick="registrarMovimientoSocio()">Registrar Operaci√≥n</button></div>
  </div>
</section>

<section class="section" id="sec-indicadores">
  <div class="card"><div class="card-title">Dashboard Financiero y de Gesti√≥n</div><div class="stat-grid" id="dash-indicadores"></div></div>
</section>

<section class="section" id="sec-informes">
  <div id="informe-body">
    <div class="tabs-row" style="margin-bottom:1rem;">
      <button class="tab-pill active" onclick="showInfTab('resumen',this)">Resumen de Ventas</button>
      <button class="tab-pill" onclick="showInfTab('diario',this)">Libro Diario</button>
      <button class="tab-pill" onclick="showInfTab('vencimientos',this)">Pr√≥ximos Vencimientos</button>
    </div>
    
    <div id="inf-resumen" class="inf-tab active">
      <div class="report-controls" style="margin-bottom:1rem;background:var(--surface);padding:1rem;border-radius:10px;">
        <div class="form-group"><label>Desde</label><input type="date" id="inf-desde"></div>
        <div class="form-group"><label>Hasta</label><input type="date" id="inf-hasta"></div>
        <button class="btn btn-primary" onclick="generarInforme()">Generar informe de ventas</button>
        <button class="btn btn-secondary" onclick="generarListaPrecios()"><span style="color:var(--accent)">üìÑ PDF</span> Lista Precios</button>
        <button class="btn btn-secondary" onclick="generarPDFPedidos()"><span style="color:var(--blue)">üì¶ PDF</span> Pedidos</button>
      </div>
      <div class="stat-grid" id="stat-grid"></div>
      <div class="card"><div class="card-title">Detalle de ventas del per√≠odo</div>
        <table><thead><tr><th>Fecha</th><th>Productos</th><th>Costo (CMV)</th><th>Venta</th><th>Margen Bruto</th></tr></thead>
        <tbody id="tabla-inf-ventas"></tbody></table>
      </div>
    </div>
    
    <div id="inf-diario" class="inf-tab" style="display:none;">
      <div class="card">
        <div class="card-title">Libro Diario General</div>
        <div class="info-tooltip" style="margin-bottom:1rem;">Nomenclatura patrimonial: <strong>(+A/-A)</strong> Activos, <strong>(+P/-P)</strong> Pasivos, <strong>(+PN/-PN)</strong> Patrimonio Neto, <strong>(+R+/-R-)</strong> Resultados.</div>
        <table><thead><tr><th>Fecha y Ref.</th><th>Cuentas Patrimoniales</th><th style="text-align:right;">Debe</th><th style="text-align:right;">Haber</th></tr></thead>
        <tbody id="tabla-diario"></tbody></table>
      </div>
    </div>

    <div id="inf-vencimientos" class="inf-tab" style="display:none;">
      <div class="card">
        <div class="card-title">Reporte de Vencimientos</div>
        <div style="display:flex; gap:.5rem; align-items:flex-end; margin-bottom:1rem; flex-wrap:wrap;">
           <div class="form-group">
              <label>Mostrar productos que vencen en los pr√≥ximos:</label>
              <div style="display:flex;align-items:center;gap:.5rem;">
                 <input type="number" id="venc-dias" value="30" step="1" min="1" style="width:80px;">
                 <span>d√≠as.</span>
              </div>
           </div>
           <button class="btn btn-primary" onclick="generarReporteVencimientos()">Generar Alerta</button>
        </div>
        <table>
          <thead><tr><th>Producto</th><th>Proveedor Reciente</th><th>Lote (Fecha Venc.)</th><th>Stock del Lote</th><th>D√≠as Restantes</th></tr></thead>
          <tbody id="tabla-inf-vencimientos"><tr><td colspan="5" style="text-align:center;">Hac√© clic en Generar Alerta para analizar el inventario.</td></tr></tbody>
        </table>
      </div>
    </div>
  </div>
</section>

<section class="section" id="sec-config">
  <div class="card">
    <div class="config-title">üè™ Datos del negocio</div>
    <div class="form-grid">
      <div class="form-group"><label>Nombre de fantas√≠a</label><input type="text" id="cfg-nombre"></div>
      <div class="form-group"><label>Direcci√≥n</label><input type="text" id="cfg-direccion"></div>
      <div class="form-group"><label>Tel√©fono</label><input type="text" id="cfg-tel"></div>
      <div class="form-group"><label>Email</label><input type="text" id="cfg-email"></div>
      <div class="form-group"><label>Instagram</label><input type="text" id="cfg-ig" placeholder="@usuario"></div>
      <div class="form-group"><label>Facebook</label><input type="text" id="cfg-fb" placeholder="/pagina"></div>
    </div>
    <div class="form-group" style="margin-top:.85rem;max-width:280px;">
      <label>Logo del negocio (Transparente)</label>
      <input type="file" id="cfg-logo-file" accept="image/*" onchange="cargarLogo(event)">
      <div id="cfg-logo-preview" style="margin-top:.5rem;"></div>
    </div>
    
    <div class="config-title" style="margin-top:1.5rem;">üé® Colores del programa (HEX)</div>
    <div class="form-grid" style="max-width:400px;">
      <div class="form-group"><label>Color Principal (Botones)</label><input type="color" id="cfg-c1" style="height:40px;padding:2px;"></div>
      <div class="form-group"><label>Color Cabecera</label><input type="color" id="cfg-c2" style="height:40px;padding:2px;"></div>
    </div>

<div class="config-title" style="margin-top:1.5rem;">üìÅ Almacenamiento (Base de Datos)</div>
    <div style="display:flex; gap: 1rem; align-items: center; margin-bottom: 1rem;">
      <button class="btn btn-blue" onclick="elegirCarpetaGuardado()">Seleccionar carpeta</button>
      <div id="ruta-guardado" style="font-family:'DM Mono',monospace; font-size:.8rem; color:var(--muted);">Guardando en memoria temporal (Navegador)</div>
    </div>
    
    <div style="margin-top:1.5rem;"><button class="btn btn-primary" onclick="guardarConfig()">üíæ Guardar configuraci√≥n</button></div>
    <div style="margin-top:2rem;padding-top:1.5rem;border-top:1px solid var(--border);">
      <button class="btn btn-green" onclick="exportarDatos()">Exportar copia (JSON)</button>
      <input type="file" id="import-file" accept=".json" onchange="importarDatos(event)" style="display:none;">
      <button class="btn btn-secondary" onclick="document.getElementById('import-file').click()">Importar copia (JSON)</button>
    </div>
    <div style="margin-top:1rem;padding-top:1rem;border-top:1px dashed var(--accent);">
      <button class="btn btn-danger" onclick="if(confirm('¬øBorrar TODO el sistema? Esta acci√≥n es irreversible.')){localStorage.removeItem(DB_KEY);location.reload();}">‚ö† Borrar todos los datos (Reset)</button>
    </div>
  </div>
</section>

</main>

<div class="modal-overlay" id="modal-qty">
  <div class="modal">
    <h2 id="modal-qty-title">Agregar</h2>
    <div class="form-group" style="margin-bottom:.85rem;">
      <label id="modal-qty-label">Cantidad</label>
      <input type="number" id="modal-qty-input" step="0.001" min="0.001" onkeydown="if(event.key==='Enter'){event.preventDefault(); event.stopPropagation(); confirmarAgregarCarrito();}">
    </div>
    <div id="modal-stock-info" style="font-size:.78rem;color:var(--muted);margin-bottom:.42rem;"></div>
    <div class="modal-actions">
      <button class="btn btn-secondary" onclick="cerrarModalQty()">Cancelar</button>
      <button class="btn btn-primary" onclick="confirmarAgregarCarrito()">Agregar ‚Üµ</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="modal-promo">
  <div class="modal" style="max-width: 600px;">
    <h2>‚≠ê Armar Promoci√≥n / Combo</h2>
    <div class="info-tooltip">Agreg√° los productos que componen el combo. El sistema calcular√° el costo base y te permitir√° aplicar un porcentaje de descuento para definir el Precio Promo final.</div>
    <div class="form-grid" style="margin-top:1rem;">
      <div class="form-group"><label>Nombre de la Promoci√≥n *</label><input type="text" id="promo-nombre" placeholder="Ej: Combo Desayuno (Caf√© + Medialunas)"></div>
      <div class="form-group"><label>Descuento a aplicar (%) *</label><input type="number" id="promo-desc" step="1" min="0" max="100" value="15" oninput="window.calcularTotalesPromo()"></div>
    </div>
    <div style="margin-top:1rem; padding:1rem; background:var(--surface2); border-radius:8px; border: 1px solid var(--border);">
      <h4 style="margin-top:0; margin-bottom:.5rem;">Productos incluidos en el combo</h4>
      <div style="display:flex; gap:5px; margin-bottom:10px;">
        <select id="promo-add-prod" style="flex:1;"></select>
        <input type="number" id="promo-add-qty" value="1" min="1" step="0.001" style="width:80px;" placeholder="Cant.">
        <button class="btn btn-secondary" onclick="window.agregarProductoPromo()">A√±adir</button>
      </div>
      <table style="margin:0; font-size:.85rem;">
        <thead><tr><th>Producto</th><th>Cant.</th><th>Costo U.</th><th>Precio Normal</th><th></th></tr></thead>
        <tbody id="tabla-promo-items"></tbody>
      </table>
    </div>
    <div style="margin-top:1.5rem; display:flex; justify-content:space-between; align-items:flex-end; border-top: 1px dashed var(--border); padding-top: 1rem;">
        <div style="font-size:0.85rem; color:var(--muted); line-height: 1.5;">
            Costo Neto de Mercader√≠a: <strong id="promo-costo" class="mono">$0.00</strong><br>
            Suma Precio Venta Individual: <strong id="promo-normal" class="mono" style="text-decoration:line-through;">$0.00</strong>
        </div>
        <div style="text-align: right;">
            <div style="font-size:0.75rem; font-weight:bold; color:var(--accent); text-transform:uppercase; margin-bottom:3px;">Precio del Combo final al cliente</div>
            <div id="promo-final" class="mono" style="font-size:1.8rem; font-weight:900; color:var(--green); line-height:1;">$0.00</div>
        </div>
    </div>
    <div class="modal-actions" style="margin-top:1.5rem;">
      <button class="btn btn-secondary" onclick="document.getElementById('modal-promo').classList.remove('open')">Cancelar</button>
      <button class="btn btn-primary" onclick="window.guardarPromoManual()">Guardar Promoci√≥n</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="modal-venta">
  <div class="modal">
    <h2>‚úÖ Venta registrada</h2>
    <div id="resumen-venta"></div>
    <div class="info-tooltip">Presiona ENTER para cerrar y nueva venta.</div>
    <div class="modal-actions"><button class="btn btn-primary" onclick="cerrarModalVenta()">Nueva venta</button></div>
  </div>
</div>

<div class="modal-overlay" id="modal-np">
  <div class="modal">
    <h2>Producto no encontrado ‚Äî Registrar</h2>
    <div class="form-grid">
      <div class="form-group">
        <label>C√≥digo interno / Barras *</label>
        <div style="display:flex;gap:5px;">
            <input type="text" id="np-codigo">
            <button class="btn btn-secondary" onclick="document.getElementById('np-codigo').value = compras.generarCodigoInterno()" title="Generar c√≥digo interno autom√°tico">‚öôÔ∏è</button>
        </div>
      </div>
      <div class="form-group"><label>Nombre *</label><input type="text" id="np-nombre"></div>
      <div class="form-group"><label>Marca</label><input type="text" id="np-marca"></div>
      <div class="form-group"><label>Unidad</label><select id="np-unidad"><option value="unidad">Unidad</option><option value="kg">Kg</option><option value="100g">100g</option></select></div>
    </div>
    <div class="modal-actions"><button class="btn btn-secondary" onclick="document.getElementById('modal-np').classList.remove('open')">Cancelar</button><button class="btn btn-primary" onclick="guardarNuevoProd()">Registrar</button></div>
  </div>
</div>

<div class="modal-overlay" id="modal-edit-prod">
  <div class="modal">
    <h2>Editar producto</h2>
    <input type="hidden" id="ep-prod-id">
    <div class="form-grid">
      <div class="form-group"><label>C√≥digo</label><input type="text" id="ep-prod-codigo"></div>
      <div class="form-group"><label>Nombre</label><input type="text" id="ep-prod-nombre"></div>
      <div class="form-group"><label>Unidad de medida</label><select id="ep-prod-unidad"><option value="unidad">Unidad</option><option value="kg">Kg</option><option value="100g">100g</option></select></div>
      <div class="form-group"><label>Marca</label><input type="text" id="ep-prod-marca"></div>
      <div class="form-group"><label>Stock M√≠nimo</label><input type="number" id="ep-prod-min" step="0.001"></div>
    </div>
    <div class="modal-actions"><button class="btn btn-secondary" onclick="document.getElementById('modal-edit-prod').classList.remove('open')">Cancelar</button><button class="btn btn-primary" onclick="guardarEditProd()">Guardar cambios</button></div>
  </div>
</div>

<div class="modal-overlay" id="modal-edit-prov">
  <div class="modal">
    <h2>Editar Proveedor</h2>
    <input type="hidden" id="eprov-id">
    <div class="form-grid">
      <div class="form-group"><label>Nombre *</label><input type="text" id="eprov-nombre"></div>
      <div class="form-group"><label>Contacto</label><input type="text" id="eprov-contacto"></div>
      <div class="form-group"><label>Tel√©fono</label><input type="text" id="eprov-tel"></div>
      <div class="form-group"><label>D√≠as de Pedido</label><select id="eprov-dias-pedido" multiple style="height:70px;"><option value="1">Lunes</option><option value="2">Martes</option><option value="3">Mi√©rcoles</option><option value="4">Jueves</option><option value="5">Viernes</option><option value="6">S√°bado</option></select></div>
      <div class="form-group"><label>D√≠as de Entrega</label><select id="eprov-dias-entrega" multiple style="height:70px;"><option value="1">Lunes</option><option value="2">Martes</option><option value="3">Mi√©rcoles</option><option value="4">Jueves</option><option value="5">Viernes</option><option value="6">S√°bado</option></select></div>
    </div>
    <div class="modal-actions"><button class="btn btn-secondary" onclick="document.getElementById('modal-edit-prov').classList.remove('open')">Cancelar</button><button class="btn btn-primary" onclick="guardarEditProv()">Guardar cambios</button></div>
  </div>
</div>

<div class="modal-overlay" id="modal-pago-deuda">
  <div class="modal">
    <h2>Pagar Deuda a Proveedor</h2>
    <input type="hidden" id="pd-id">
    <div class="form-grid">
      <div class="form-group"><label>Monto a pagar ahora ($)</label><input type="number" id="pd-monto" step="0.01" value="0"></div>
      <div class="form-group"><label>Descuento obtenido ($)</label><input type="number" id="pd-descuento" step="0.01" value="0" placeholder="Ej: 500"></div>
      <div class="form-group"><label>Desde cuenta</label><select id="pd-cuenta"></select></div>
    </div>
    <div class="modal-actions"><button class="btn btn-secondary" onclick="document.getElementById('modal-pago-deuda').classList.remove('open')">Cancelar</button><button class="btn btn-primary" onclick="confirmarPagoDeuda()">Registrar Pago</button></div>
  </div>
</div>

<div class="modal-overlay" id="modal-retiro-socio">
  <div class="modal">
    <h2>üì¶ Retiro de Mercader√≠a por Socio</h2>
    <div class="form-grid">
      <div class="form-group"><label>Producto *</label><select id="rs-prod"></select></div>
      <div class="form-group"><label>Cantidad *</label><input type="number" id="rs-qty" step="0.001" min="0"></div>
      <div class="form-group"><label>Socio que retira *</label><select id="rs-socio"></select></div>
      <div class="form-group"><label>Asignaci√≥n Contable *</label>
        <select id="rs-accion">
          <option value="descontar">Descontar del Saldo del Socio (Retiro)</option>
          <option value="perdida">P√©rdida/Gasto General del Negocio</option>
        </select>
      </div>
    </div>
    <div class="info-tooltip">Calcula el Costo (CMV) PEPS y se resta del saldo personal del socio (si se elige descontar).</div>
    <div class="modal-actions"><button class="btn btn-secondary" onclick="document.getElementById('modal-retiro-socio').classList.remove('open')">Cancelar</button><button class="btn btn-blue" onclick="confirmarRetiroSocio()">Registrar Salida</button></div>
  </div>
</div>

<div class="modal-overlay" id="modal-muestras">
  <div class="modal">
    <h2>üéÅ Registrar Muestra o Sorteo</h2>
    <div class="form-grid">
      <div class="form-group"><label>Producto *</label><select id="mu-prod"></select></div>
      <div class="form-group"><label>Cantidad *</label><input type="number" id="mu-qty" step="0.001" min="0"></div>
      <div class="form-group"><label>Fecha *</label><input type="date" id="mu-fecha"></div>
    </div>
    <div class="info-tooltip">Esta mercader√≠a se descontar√° del stock (PEPS) y se imputar√° autom√°ticamente como un gasto de "Publicidad / Muestras".</div>
    <div class="modal-actions"><button class="btn btn-secondary" onclick="document.getElementById('modal-muestras').classList.remove('open')">Cancelar</button><button class="btn btn-purple" onclick="confirmarMuestra()">Registrar Gasto</button></div>
  </div>
</div>

<div class="modal-overlay" id="modal-precios">
  <div class="modal" style="max-width:600px;">
    <h2>‚ö†Ô∏è Precios Desactualizados en G√≥ndola</h2>
    <div class="info-tooltip">Listado de productos con stock cuyo precio calculado actual difiere del √∫ltimo marcado. Actualiz√° la etiqueta en el local y marc√° "Listo".</div>
    <div style="max-height:300px; overflow-y:auto;">
      <table style="margin-bottom:0;">
        <thead><tr><th>Producto</th><th>Precio Anterior</th><th>Nuevo Sugerido</th><th>Acci√≥n</th></tr></thead>
        <tbody id="tabla-precios-desact"></tbody>
      </table>
    </div>
    <div class="modal-actions" style="margin-top:15px;">
        <button class="btn btn-secondary" onclick="document.getElementById('modal-precios').classList.remove('open')">Cerrar</button>
        <button class="btn btn-primary" onclick="generarPDFEtiquetas()">Imprimir C√≥digos (PDF)</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="modal-edit-cliente">
  <div class="modal">
    <h2>Editar Cliente</h2>
    <input type="hidden" id="ecli-id">
    <div class="form-grid">
      <div class="form-group"><label>Nombre / Raz√≥n Social *</label><input type="text" id="ecli-nombre"></div>
      <div class="form-group"><label>Tel√©fono</label><input type="text" id="ecli-tel"></div>
      <div class="form-group"><label>Direcci√≥n</label><input type="text" id="ecli-dir"></div>
      <div class="form-group"><label>L√≠mite de Cr√©dito ($)</label><input type="number" id="ecli-limite" step="1000" min="0"></div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-secondary" onclick="document.getElementById('modal-edit-cliente').classList.remove('open')">Cancelar</button>
      <button class="btn btn-primary" onclick="guardarEditCliente()">Guardar cambios</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="modal-cobro-cliente">
  <div class="modal">
    <h2>Cobrar a Cuenta Corriente</h2>
    <input type="hidden" id="cobro-cli-id">
    <div class="form-grid">
      <div class="form-group"><label>Monto a cobrar ($) *</label><input type="number" id="cobro-monto" step="0.01" min="0.01"></div>
      <div class="form-group"><label>Fecha</label><input type="date" id="cobro-fecha"></div>
      <div class="form-group"><label>Ingresar fondos a *</label><select id="cobro-cuenta"></select></div>
      <div class="form-group"><label>Descripci√≥n</label><input type="text" id="cobro-desc"></div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-secondary" onclick="document.getElementById('modal-cobro-cliente').classList.remove('open')">Cancelar</button>
      <button class="btn btn-green" onclick="confirmarCobroCliente()">Registrar Cobro</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="modal-historial-cliente">
  <div class="modal" style="max-width: 600px;">
    <h2>Historial: <span id="historial-cli-nombre"></span></h2>
    <div style="max-height: 400px; overflow-y: auto; margin-top: 1rem;">
      <table style="margin-bottom: 0;">
        <thead>
          <tr>
            <th>Fecha</th>
            <th>Descripci√≥n</th>
            <th style="text-align:right;">Cargos ($)</th>
            <th style="text-align:right;">Pagos ($)</th>
          </tr>
        </thead>
        <tbody id="tabla-historial-cliente"></tbody>
      </table>
    </div>
    <div class="modal-actions" style="margin-top: 15px;">
      <button class="btn btn-secondary" onclick="document.getElementById('modal-historial-cliente').classList.remove('open')">Cerrar</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="modal-venta-historica">
  <div class="modal" style="max-width: 700px;">
    <h2>‚è≥ Cargar Venta Hist√≥rica / Atrasada</h2>
    <div class="info-tooltip">Us√° esta herramienta para registrar ventas de d√≠as anteriores o momentos sin sistema. Se descontar√° el stock actual, pero la venta figurar√° con la fecha y hora que elijas en los reportes.</div>

    <div class="form-grid" style="margin-top:1rem;">
      <div class="form-group"><label>Fecha Exacta *</label><input type="date" id="vh-fecha"></div>
      <div class="form-group"><label>Hora Exacta *</label><input type="time" id="vh-hora"></div>
      <div class="form-group"><label>Cobrado en Cuenta *</label><select id="vh-cuenta"></select></div>
    </div>

    <div style="margin-top:1rem; padding:1rem; background:var(--surface2); border-radius:8px; border: 1px solid var(--border);">
      <h4 style="margin-top:0; margin-bottom:.5rem;">Agregar Productos Vendidos</h4>
      <div style="display:flex; gap:5px; margin-bottom:10px;">
        <input type="text" id="vh-prod-search" placeholder="üîç Buscar producto..." oninput="window.buscarProdVentaHistorica()" style="flex:1;">
        <select id="vh-prod-select" style="flex:2; display:none;"></select>
        <input type="number" id="vh-qty" value="1" min="0.001" step="0.001" style="width:80px;" placeholder="Cant.">
        <button class="btn btn-secondary" onclick="window.agregarItemVentaHistorica()">A√±adir</button>
      </div>
      <table style="margin:0; font-size:.85rem;">
        <thead><tr><th>Producto</th><th>Cant.</th><th>Precio U.</th><th>Subtotal</th><th></th></tr></thead>
        <tbody id="tabla-vh-items"><tr><td colspan="5" style="text-align:center;color:var(--muted)">Sin productos cargados.</td></tr></tbody>
      </table>
    </div>

    <div style="margin-top:1.5rem; display:flex; justify-content:space-between; align-items:center; border-top: 1px dashed var(--border); padding-top: 1rem;">
        <div style="font-size:0.85rem; color:var(--muted);">Costo CMV Estimado: <strong id="vh-costo-total" class="mono">$0.00</strong></div>
        <div style="text-align: right;">
            <div style="font-size:0.75rem; font-weight:bold; color:var(--accent); text-transform:uppercase; margin-bottom:3px;">Total de la Venta</div>
            <div id="vh-total-final" class="mono" style="font-size:1.8rem; font-weight:900; color:var(--green); line-height:1;">$0.00</div>
        </div>
    </div>

    <div class="modal-actions" style="margin-top:1.5rem;">
      <button class="btn btn-secondary" onclick="window.cerrarModalVentaHistorica()">Cancelar</button>
      <button class="btn btn-primary" onclick="window.confirmarVentaHistorica()">Registrar Venta Atrasada</button>
    </div>
  </div>
</div>
<div class="modal-overlay" id="modal-auditoria">
  <div class="modal" style="max-width: 800px;">
    <h2>‚öñÔ∏è Auditor√≠a y Ajuste F√≠sico de Inventario</h2>
    <div class="info-tooltip">Busc√° o escane√° productos, cont√° cu√°ntos hay en la g√≥ndola y anot√° el Stock Real. Las diferencias negativas se registrar√°n autom√°ticamente como p√©rdidas (CMV) en Gastos.</div>

    <div style="display:flex; gap:10px; margin-top:1rem; margin-bottom:1rem; align-items: center;">
      <input type="text" id="aud-search" placeholder="üîç Buscar producto o escanear c√≥digo de barras..." oninput="window.filtrarAuditoria()" style="flex:1; min-width: 0;">
      <select id="aud-filtro" onchange="window.filtrarAuditoria()" style="width: 250px; flex-shrink: 0;">
        <option value="todos">Todos</option>
        <option value="diferencia">Solo con diferencias</option>
      </select>
    </div>

    <div style="max-height: 400px; overflow-y: auto; border: 1px solid var(--border); border-radius: 5px;">
      <table style="margin: 0;">
        <thead style="position: sticky; top: 0; background: var(--surface); z-index: 1;">
          <tr>
            <th>C√≥digo</th>
            <th>Producto</th>
            <th style="text-align:center;">Stock Sistema</th>
            <th style="text-align:center; width: 130px;">Stock Real</th>
            <th style="text-align:center;">Diferencia</th>
          </tr>
        </thead>
        <tbody id="tabla-auditoria-items">
          </tbody>
      </table>
    </div>

    <div class="modal-actions" style="margin-top:1.5rem;">
      <button class="btn btn-secondary" onclick="window.cerrarModalAuditoria()">Cerrar / Cancelar</button>
      <button class="btn btn-primary" onclick="window.confirmarAuditoria()">Aplicar Ajustes F√≠sicos</button>
    </div>
  </div>
</div>
<div id="toast"></div>

<script src="app.js"></script>
</body>
</html>