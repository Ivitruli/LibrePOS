<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com https://cdnjs.cloudflare.com data: blob:;">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LibrePOS - GestiÃ³n AlmacÃ©n</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Mono:wght@400;500&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<header>
  <div class="header-brand">
    <img id="header-logo" class="header-logo" src="" alt="Logo">
    <h1 id="header-title">Libre<span>POS</span></h1>
  </div>
  <nav class="nav-tabs">
    <button class="nav-tab active" onclick="showSection('pos',this)">ğŸ›’ POS</button>
    <button class="nav-tab" onclick="showSection('compras',this)">ğŸ“¥ Compras</button>
    <button class="nav-tab" id="tab-stock" onclick="showSection('stock',this)">ğŸ“¦ Stock</button>
    <button class="nav-tab" onclick="showSection('ventas',this)">ğŸ§¾ Ventas</button>
    <button class="nav-tab" onclick="showSection('proveedores',this)">ğŸšš Prov.</button>
    <button class="nav-tab" onclick="showSection('gastos',this)">ğŸ’¸ Gastos</button>
    <button class="nav-tab" onclick="showSection('finanzas',this)">ğŸ“ˆ Finanzas</button>
    <button class="nav-tab" onclick="showSection('socios',this)">ğŸ¤ Socios</button>
    <button class="nav-tab" onclick="showSection('indicadores',this)">ğŸ“Š Indicadores</button>
    <button class="nav-tab" onclick="showSection('informes',this)">ğŸ“ Informes</button>
    <button class="nav-tab" onclick="showSection('config',this)">âš™ï¸ Config</button>
  </nav>
</header>
<main>

<section class="section active" id="sec-pos">
  <div id="alertas-venc-pos"></div>
  <div class="pos-layout">
    <div>
      <div class="card">
        <div class="barcode-wrap">
          <input type="text" id="pos-barcode" placeholder="Esperando cÃ³digo... (o ENTER para confirmar venta)" oninput="handleBarcodeInput()" autofocus>
        </div>
        <div style="font-size:.73rem;color:var(--muted);margin-bottom:.65rem;font-weight:600;">â†‘ Lectora de cÃ³digo Â· O buscÃ¡ por nombre:</div>
        <input type="text" id="pos-search" placeholder="Buscar por nombre o marca..." oninput="filterProducts()" style="margin-bottom:.85rem;">
        <div class="product-grid" id="product-grid"></div>
      </div>
    </div>
    <div class="cart-panel">
      <div class="cart-header">ğŸ›’ Venta actual</div>
      <div class="cart-items" id="cart-items"><div style="padding:2rem 1rem;text-align:center;color:var(--muted);font-size:.82rem;">SeleccionÃ¡ productos</div></div>
      <div class="cart-footer">
        
        <div style="display:flex;align-items:center;gap:.4rem;margin-bottom:.8rem;background:var(--surface2);padding:.4rem;border-radius:5px;">
          <input type="checkbox" id="cart-venta-costo" onchange="toggleCartCosto()"> 
          <label for="cart-venta-costo" style="color:var(--ink);cursor:pointer;margin:0;">Aplicar Venta al Costo a todo el carrito</label>
        </div>
        
        <div style="font-size:.69rem;font-weight:600;text-transform:uppercase;color:var(--muted);margin-bottom:.38rem;">Medio de pago</div>
        <div class="medios-pago" id="medios-pago-btns"></div>
        <div id="cart-desc-row" style="background:var(--green-light);border:1px solid var(--green);border-radius:5px;padding:.42rem .72rem;margin-bottom:.6rem;font-size:.78rem;color:var(--green);display:none;font-weight:600;"></div>
        
        <div style="margin-top: 10px; margin-bottom: 15px; border-top: 1px dashed var(--border); padding-top: 15px; display: flex; flex-direction: column; gap: 12px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <button id="btnRedondeo" class="btn btn-sm btn-secondary" onclick="uiAplicarRedondeo()">Redondear (Sug: $0)</button>
                <span id="lblDescuentoAplicado" class="mono" style="color: var(--accent); font-weight: bold;">-$0.00</span>
            </div>

            <div style="display: flex; align-items: center; justify-content: space-between;">
                <div style="display: flex; align-items: center; gap: 8px;">
                    <input type="checkbox" id="chkEnvio" onchange="uiActualizarTotalPOS()">
                    <label for="chkEnvio" style="margin: 0; font-size: .85rem;">EnvÃ­o a dom.</label>
                </div>
                <input type="number" id="inputCostoEnvio" class="edit-inline" style="display: none; width: 80px;" oninput="uiActualizarTotalPOS()" placeholder="Costo $">
            </div>
        </div>

        <div class="cart-totales">
          <div class="cart-total-row" id="cart-total-sin-desc-row" style="display:none;">
            <span style="font-size:.72rem;text-transform:uppercase;color:var(--muted);font-weight:600;">Sin descuento</span>
            <span class="mono" id="cart-total-sin-desc" style="font-size:1rem;color:var(--muted);text-decoration:line-through;"></span>
          </div>
          <div class="cart-total-row" style="border-top: 2px solid var(--ink); padding-top: 10px;">
            <span style="font-size:.72rem;text-transform:uppercase;color:var(--muted);font-weight:600;" id="cart-total-label">Total</span>
            <span class="cart-total-amount" id="cart-total">$0</span>
          </div>
        </div>
        
        <button class="btn btn-green" style="width:100%;font-size:.95rem;padding:.82rem;margin-top:15px;" onclick="confirmarVenta()">Confirmar venta (Enter)</button>
        <button class="btn btn-secondary" style="width:100%;margin-top:.42rem;" onclick="limpiarCarrito()">Cancelar</button>
      </div>
    </div>
  </div>
</section>

<section class="section" id="sec-compras">
  <div class="card">
    <div class="card-title">Registrar lote de compra</div>
    <div class="form-grid">
      <div class="form-group"><label>CÃ³digo de barras / interno *</label><input type="text" id="comp-barcode" placeholder="EscaneÃ¡ o escribÃ­" onblur="buscarProdCompra()"></div>
      <div class="form-group"><label>Producto (autocompletado)</label><input type="text" id="comp-prod-nombre" readonly style="background:var(--surface2);" placeholder="â€”"><input type="hidden" id="comp-prod-id"></div>
      <div class="form-group"><label>Fecha *</label><input type="date" id="comp-fecha"></div>
      <div class="form-group"><label>Vencimiento</label><input type="date" id="comp-venc"></div>
      <div class="form-group"><label>Cantidad *</label><input type="number" id="comp-cantidad" step="0.001" min="0" placeholder="0"></div>
      <div class="form-group"><label>Costo unitario ($) *</label><input type="number" id="comp-costo" step="0.01" min="0" placeholder="0.00" oninput="calcularPrecio()"></div>
      <div class="form-group"><label>Estado del Pago</label>
        <select id="comp-pago" onchange="togglePagoCompra(this.value)"><option value="pagado">Pagado ahora</option><option value="adeudado">A cuenta (Deuda)</option></select>
      </div>
      <div class="form-group" id="comp-cuenta-wrap"><label>Pagado desde cuenta</label><select id="comp-cuenta"></select></div>
    </div>
    <div class="precio-calc">
      <div style="font-size:.71rem;font-weight:600;text-transform:uppercase;color:var(--amber);margin-bottom:.72rem;">ğŸ“Š Calculadora de precio de venta</div>
      <div class="form-grid" style="grid-template-columns:repeat(auto-fit,minmax(120px,1fr));">
        <div class="form-group"><label>+Fijo ($)</label><input type="number" id="calc-fijo" value="0" step="0.01" oninput="calcularPrecio()"></div>
        <div class="form-group"><label>+Impuestos (%)</label><input type="number" id="calc-imp" value="0" step="0.1" oninput="calcularPrecio()"></div>
        <div class="form-group"><label>+Ganancia (%)</label><input type="number" id="calc-gan" value="30" step="0.1" oninput="calcularPrecio()"></div>
        <div class="form-group"><label>âˆ’Descuento (%)</label><input type="number" id="calc-desc" value="0" step="0.1" oninput="calcularPrecio()"></div>
        <div class="form-group"><label>Precio final â–² ($)</label><input type="number" id="comp-precio" step="10" style="border-color:var(--amber);font-weight:600;font-size:1.1rem;" placeholder="0"></div>
      </div>
      <div id="precio-result-txt" style="font-size:.78rem;color:var(--amber);margin-top:.52rem;font-family:'DM Mono',monospace;font-weight:600;"></div>
    </div>
    <div style="margin-top:1.05rem;"><button class="btn btn-primary" onclick="registrarCompra()">Registrar compra e ingresar a stock</button></div>
  </div>
</section>

<section class="section" id="sec-stock">
  <div id="alertas-venc-stock"></div>
  <div class="card">
    <div class="card-title">Reglas de precios globales</div>
    <div style="display:flex;gap:.85rem;align-items:flex-end;flex-wrap:wrap;">
      <div class="form-group"><label>Descuento por pago en Efectivo (%)</label><input type="number" id="cfg-desc-efectivo" step="0.5" min="0" max="50" placeholder="10" value="10"></div>
      <button class="btn btn-primary" onclick="guardarDescEfectivo()">Guardar regla</button>
    </div>
    <div class="info-tooltip">Se aplica en POS al elegir Efectivo. Productos con "Venta al Costo" o "âˆ’Desc%" propio en la tabla de abajo NO reciben este descuento extra.</div>
  </div>
  <div class="card">
    <div class="card-title">CatÃ¡logo â€” ModificaciÃ³n y Precios</div>
    <div style="display:flex;gap:.5rem;margin-bottom:.95rem;"><input type="text" id="stock-search" placeholder="ğŸ” Buscar por nombre, marca, cÃ³digo..." oninput="renderTablaProductos()" style="flex:1;"></div>
    <div style="overflow-x:auto;">
    <table id="tabla-stock-cat">
      <thead><tr>
        <th>Proveedor</th><th>CÃ³digo</th><th>Nombre</th><th>Unidad</th><th>Stock Min.</th>
        <th>Stock Real</th><th>Costo</th><th>+Fijo$</th><th>+Imp%</th><th>+Gan%</th><th>âˆ’Desc%</th>
        <th title="Ignora ganancia y descuento">Al Costo</th><th>Precio final</th>
        <th>Acciones</th>
      </tr></thead>
      <tbody id="tabla-productos"></tbody>
    </table>
    </div>
    <div style="display:flex;justify-content:space-between;align-items:center;margin-top:.75rem;">
      <button class="btn btn-blue" onclick="abrirRetiroSocio()">ğŸ“¦ Retiro de Socios</button>
      <button class="btn btn-green" onclick="guardarPreciosTodos()">ğŸ’¾ Guardar cambios de precios</button>
    </div>
  </div>
</section>

<section class="section" id="sec-ventas">
  <div class="card">
    <div class="card-title">Listado de ventas</div>
    <div style="display:flex;gap:.5rem;flex-wrap:wrap;align-items:center;margin-bottom:.9rem;">
      <input type="date" id="vent-f-desde" style="max-width:150px;"> <input type="date" id="vent-f-hasta" style="max-width:150px;">
      <select id="vent-filtro-medio" style="max-width:165px;"><option value="">Todos los medios</option></select>
      <select id="vent-filtro-fact" style="max-width:165px;"><option value="">Todas</option><option value="si">Facturadas</option><option value="no">Sin facturar</option></select>
      <button class="btn btn-secondary btn-sm" onclick="renderTablaVentas()">Filtrar</button>
    </div>
    <table>
      <thead><tr><th>Fecha/Hora</th><th>Productos</th><th>Total</th><th>Desc. ef.</th><th>Medio</th><th>Facturada</th></tr></thead>
      <tbody id="tabla-ventas-menu"></tbody>
    </table>
    <div id="ventas-resumen-row" style="text-align:right;padding:.7rem;font-family:'DM Mono',monospace;font-weight:600;"></div>
  </div>
</section>

<section class="section" id="sec-proveedores">
  <div class="tabs-row">
    <button class="tab-pill active" onclick="showProvTab('list',this)">Directorio de Proveedores</button>
    <button class="tab-pill" onclick="showProvTab('deudas',this)">Cuentas por Pagar (Deudas)</button>
  </div>
  
  <div id="prov-list" class="prov-tab">
    <div class="card">
      <div class="card-title">Nuevo proveedor</div>
      <div class="form-grid">
        <div class="form-group"><label>Nombre *</label><input type="text" id="prov-nombre"></div>
        <div class="form-group"><label>Contacto</label><input type="text" id="prov-contacto"></div>
        <div class="form-group"><label>TelÃ©fono</label><input type="text" id="prov-tel"></div>
        <div class="form-group"><label>DÃ­as de Pedido</label>
          <select id="prov-dias-pedido" multiple style="height:70px;padding:.2rem;"><option value="1">Lunes</option><option value="2">Martes</option><option value="3">MiÃ©rcoles</option><option value="4">Jueves</option><option value="5">Viernes</option><option value="6">SÃ¡bado</option></select>
        </div>
        <div class="form-group"><label>DÃ­as de Entrega</label>
          <select id="prov-dias-entrega" multiple style="height:70px;padding:.2rem;"><option value="1">Lunes</option><option value="2">Martes</option><option value="3">MiÃ©rcoles</option><option value="4">Jueves</option><option value="5">Viernes</option><option value="6">SÃ¡bado</option></select>
        </div>
      </div>
      <div class="info-tooltip">MantenÃ© presionado CTRL (o CMD en Mac) para seleccionar varios dÃ­as.</div>
      <div style="margin-top:.95rem;"><button class="btn btn-primary" onclick="agregarProveedor()">Agregar proveedor</button></div>
    </div>
    <div class="card"><div class="card-title">Proveedores registrados</div><div id="tabla-proveedores-container"></div></div>
  </div>

  <div id="prov-deudas" class="prov-tab" style="display:none;">
    <div class="card">
      <div class="card-title">Registrar deuda manual a proveedor</div>
      <div class="form-grid">
        <div class="form-group"><label>Proveedor *</label><select id="deuda-prov"></select></div>
        <div class="form-group"><label>Fecha *</label><input type="date" id="deuda-fecha"></div>
        <div class="form-group"><label>Monto a deber ($) *</label><input type="number" id="deuda-monto" step="0.01" min="0"></div>
        <div class="form-group"><label>DescripciÃ³n</label><input type="text" id="deuda-desc" placeholder="Ej: Saldo factura A-001"></div>
        <div class="form-group" style="justify-content:flex-end;"><button class="btn btn-primary" onclick="registrarDeuda()">Registrar Deuda</button></div>
      </div>
    </div>
    <div class="card">
      <div class="card-title">Deudas Pendientes (Pasivos)</div>
      <table><thead><tr><th>Fecha</th><th>Proveedor</th><th>DescripciÃ³n</th><th>Monto Original</th><th>Falta Pagar</th><th>Pagar Ahora</th></tr></thead>
      <tbody id="tabla-deudas"></tbody></table>
    </div>
  </div>
</section>

<section class="section" id="sec-gastos">
  <div class="card">
    <div class="card-title">Registrar gasto</div>
    <div class="form-grid">
      <div class="form-group"><label>Fecha *</label><input type="date" id="gasto-fecha"></div>
      <div class="form-group"><label>CategorÃ­a *</label>
        <select id="gasto-cat"><option>MercaderÃ­a no inventariable</option><option>Servicios (luz/gas)</option><option>Alquiler</option><option>Sueldos</option><option>Impuestos/Monotributo</option><option>Mantenimiento</option><option>Retiro MercaderÃ­a</option><option>Otros</option></select>
      </div>
      <div class="form-group"><label>Tipo de Gasto</label>
        <select id="gasto-tipo"><option value="variable">Gasto Variable</option><option value="fijo">Gasto Fijo</option></select>
      </div>
      <div class="form-group"><label>Importe ($) *</label><input type="number" id="gasto-importe" step="0.01" min="0"></div>
      <div class="form-group"><label>Pagado desde cuenta *</label><select id="gasto-cuenta"></select></div>
      <div class="form-group"><label>DescripciÃ³n</label><input type="text" id="gasto-desc"></div>
    </div>
    <div style="margin-top:1rem;"><button class="btn btn-primary" onclick="registrarGasto()">Registrar gasto</button></div>
  </div>
  <div class="card">
    <div class="card-title">Historial de gastos</div>
    <table><thead><tr><th>Fecha</th><th>CategorÃ­a</th><th>Tipo</th><th>DescripciÃ³n</th><th>Importe</th><th>Cuenta</th><th></th></tr></thead>
    <tbody id="tabla-gastos"></tbody></table>
  </div>
</section>

<section class="section" id="sec-finanzas">
  <div class="stat-grid">
    <div class="stat-card"><div class="stat-label">Capital Propio</div><div class="stat-value" id="fin-capital">...</div><div class="stat-sub">Patrimonio Neto âˆ’ Ganancias</div></div>
    <div class="stat-card" style="border-left-color:var(--green);"><div class="stat-label">Ganancia Sin Asignar</div><div class="stat-value" style="color:var(--green)" id="fin-ganancia">...</div><div class="stat-sub">Disponible para reinvertir o asignar a socios</div></div>
    <div class="stat-card" style="border-left-color:var(--ink);"><div class="stat-label">Liquidez Total</div><div class="stat-value" id="fin-liquidez">...</div><div class="stat-sub">Dinero real en todas las cuentas</div></div>
  </div>
  
  <div class="card">
    <div class="card-title">Cuentas y Medios de Pago (Ajuste de Caja)</div>
    <div class="info-tooltip" style="margin-bottom:1rem;">El <strong>Saldo Sistema</strong> se calcula automÃ¡ticamente. Si contaste la plata y hay diferencia, ingresÃ¡ el <strong>Saldo Real</strong> y ajustÃ¡ para crear un asiento contable automÃ¡tico.</div>
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1rem;" id="lista-cuentas"></div>
    <div style="margin-top:1.5rem;padding-top:1rem;border-top:1px solid var(--border);">
      <h4 style="font-size:.9rem;margin-bottom:.5rem;">Crear nueva cuenta</h4>
      <div style="display:flex;gap:.5rem;">
        <input type="text" id="nueva-cta-nombre" placeholder="Ej: Banco Galicia" style="max-width:200px;">
        <input type="number" id="nueva-cta-saldo" placeholder="Saldo inicial ($)" style="max-width:150px;">
        <button class="btn btn-secondary" onclick="crearCuenta()">AÃ±adir Cuenta</button>
      </div>
    </div>
  </div>
  <div class="card"><div class="card-title">Cashflow Semanal (Ãšltimos 30 dÃ­as)</div><div class="chart-container"><canvas id="chart-cashflow"></canvas></div></div>
</section>

<section class="section" id="sec-socios">
  <div class="stat-grid">
    <div class="stat-card"><div class="stat-label">Ganancia Neta Global</div><div class="stat-value mono" id="soc-neta">...</div><div class="stat-sub">Rendimiento HistÃ³rico</div></div>
    <div class="stat-card" style="border-left-color:var(--amber);"><div class="stat-label">Ganancia Sin Asignar</div><div class="stat-value mono" style="color:var(--amber)" id="soc-disp">...</div><div class="stat-sub">Fondos libres de la empresa</div></div>
  </div>
  <div class="card">
    <div class="card-title">Socios y Cuentas Particulares</div>
    <div style="display:flex;gap:.5rem;align-items:flex-end;margin-bottom:.95rem;">
      <div class="form-group"><label>Nombre</label><input type="text" id="socio-nombre"></div>
      <div class="form-group"><label>DNI / CUIT</label><input type="text" id="socio-dni" placeholder="Sin puntos"></div>
      <button class="btn btn-primary" onclick="agregarSocio()">Crear Socio</button>
    </div>
    <div id="lista-socios"></div>
  </div>
  
  <div class="card">
    <div class="card-title">Operaciones de Socios (Libro Diario)</div>
    <div class="form-grid">
      <div class="form-group"><label>Socio *</label><select id="mov-socio"></select></div>
      <div class="form-group"><label>OperaciÃ³n Contable *</label>
        <select id="mov-tipo" onchange="document.getElementById('mov-cuenta-wrap').style.display=(this.value==='asignacion'||this.value==='reinversion')?'none':'flex'">
          <option value="deposito">ğŸ“¥ DepÃ³sito de Capital (Socio aporta dinero a la empresa)</option>
          <option value="asignacion">ğŸ“Š Asignar Ganancia (Pasar utilidades al saldo personal del socio)</option>
          <option value="retiro">ğŸ“¤ Retirar Fondos / PrÃ©stamo (Puede quedar en negativo si extrae de mÃ¡s)</option>
          <option value="reinversion">â™»ï¸ Reinvertir Utilidades (Pasa Ganancia libre a Capital Propio General)</option>
        </select>
      </div>
      <div class="form-group"><label>Monto ($) *</label><input type="number" id="mov-importe" step="0.01"></div>
      <div class="form-group" id="mov-cuenta-wrap"><label>Cuenta Bancaria/Caja afectada</label><select id="mov-cuenta"></select></div>
      <div class="form-group"><label>Fecha</label><input type="date" id="mov-fecha"></div>
    </div>
    <div class="info-tooltip">Para <strong>Reinvertir utilidades</strong>, no es necesario seleccionar a un socio en particular.</div>
    <div style="margin-top:1rem;"><button class="btn btn-primary" onclick="registrarMovimientoSocio()">Registrar OperaciÃ³n</button></div>
  </div>
</section>

<section class="section" id="sec-indicadores">
  <div class="card"><div class="card-title">Dashboard Financiero y de GestiÃ³n</div><div class="stat-grid" id="dash-indicadores"></div></div>
</section>

<section class="section" id="sec-informes">
  <div class="report-controls">
    <div class="form-group"><label>Desde</label><input type="date" id="inf-desde"></div>
    <div class="form-group"><label>Hasta</label><input type="date" id="inf-hasta"></div>
    <button class="btn btn-primary" onclick="generarInforme()">Generar informe en pantalla</button>
    <button class="btn btn-secondary" onclick="generarListaPrecios()"><span style="color:var(--accent)">ğŸ“„ PDF</span> Lista Precios</button>
    <button class="btn btn-secondary" onclick="generarPDFPedidos()"><span style="color:var(--blue)">ğŸ“¦ PDF</span> Pedidos</button>
  </div>
  
  <div id="informe-body" style="display:none">
    <div class="tabs-row">
      <button class="tab-pill active" onclick="showInfTab('resumen',this)">Resumen de Ventas</button>
      <button class="tab-pill" onclick="showInfTab('diario',this)">Libro Diario (Partida Doble)</button>
    </div>
    
    <div id="inf-resumen" class="inf-tab active">
      <div class="stat-grid" id="stat-grid"></div>
      <div class="card"><div class="card-title">Detalle de ventas del perÃ­odo</div>
        <table><thead><tr><th>Fecha</th><th>Productos</th><th>Costo (CMV)</th><th>Venta</th><th>Margen Bruto</th></tr></thead>
        <tbody id="tabla-inf-ventas"></tbody></table>
      </div>
    </div>
    
    <div id="inf-diario" class="inf-tab">
      <div class="card">
        <div class="card-title">Libro Diario General</div>
        <div class="info-tooltip" style="margin-bottom:1rem;">Nomenclatura patrimonial: <strong>(+A/-A)</strong> Activos, <strong>(+P/-P)</strong> Pasivos, <strong>(+PN/-PN)</strong> Patrimonio Neto, <strong>(+R+/-R-)</strong> Resultados / Ingresos y Egresos. Las cuentas de los socios actÃºan como <strong>(-P/+A)</strong> segÃºn si la empresa les debe a ellos o ellos a la empresa.</div>
        <table><thead><tr><th>Fecha y Ref.</th><th>Cuentas Patrimoniales</th><th style="text-align:right;">Debe</th><th style="text-align:right;">Haber</th></tr></thead>
        <tbody id="tabla-diario"></tbody></table>
      </div>
    </div>
  </div>
</section>

<section class="section" id="sec-config">
  <div class="card">
    <div class="config-title">ğŸª Datos del negocio</div>
    <div class="form-grid">
      <div class="form-group"><label>Nombre de fantasÃ­a</label><input type="text" id="cfg-nombre"></div>
      <div class="form-group"><label>DirecciÃ³n</label><input type="text" id="cfg-direccion"></div>
      <div class="form-group"><label>TelÃ©fono</label><input type="text" id="cfg-tel"></div>
      <div class="form-group"><label>Email</label><input type="text" id="cfg-email"></div>
      <div class="form-group"><label>Instagram</label><input type="text" id="cfg-ig" placeholder="@usuario"></div>
      <div class="form-group"><label>Facebook</label><input type="text" id="cfg-fb" placeholder="/pagina"></div>
    </div>
    <div class="form-group" style="margin-top:.85rem;max-width:280px;">
      <label>Logo del negocio (Transparente)</label>
      <input type="file" id="cfg-logo-file" accept="image/*" onchange="cargarLogo(event)">
      <div id="cfg-logo-preview" style="margin-top:.5rem;"></div>
    </div>
    
    <div class="config-title" style="margin-top:1.5rem;">ğŸ¨ Colores del programa (HEX)</div>
    <div class="form-grid" style="max-width:400px;">
      <div class="form-group"><label>Color Principal (Botones)</label><input type="color" id="cfg-c1" style="height:40px;padding:2px;"></div>
      <div class="form-group"><label>Color Cabecera</label><input type="color" id="cfg-c2" style="height:40px;padding:2px;"></div>
    </div>

<div class="config-title" style="margin-top:1.5rem;">ğŸ“ Almacenamiento (Base de Datos)</div>
    <div style="display:flex; gap: 1rem; align-items: center; margin-bottom: 1rem;">
      <button class="btn btn-blue" onclick="elegirCarpetaGuardado()">Seleccionar carpeta</button>
      <div id="ruta-guardado" style="font-family:'DM Mono',monospace; font-size:.8rem; color:var(--muted);">Guardando en memoria temporal (Navegador)</div>
    </div>
    
    <div style="margin-top:1.5rem;"><button class="btn btn-primary" onclick="guardarConfig()">ğŸ’¾ Guardar configuraciÃ³n</button></div>
    <div style="margin-top:2rem;padding-top:1.5rem;border-top:1px solid var(--border);">
      <button class="btn btn-green" onclick="exportarDatos()">Exportar copia (JSON)</button>
      <input type="file" id="import-file" accept=".json" onchange="importarDatos(event)" style="display:none;">
      <button class="btn btn-secondary" onclick="document.getElementById('import-file').click()">Importar copia (JSON)</button>
    </div>
    <div style="margin-top:1rem;padding-top:1rem;border-top:1px dashed var(--accent);">
      <button class="btn btn-danger" onclick="if(confirm('Â¿Borrar TODO el sistema? Esta acciÃ³n es irreversible.')){localStorage.removeItem(DB_KEY);location.reload();}">âš  Borrar todos los datos (Reset)</button>
    </div>
  </div>
</section>

</main>

<div class="modal-overlay" id="modal-qty">
  <div class="modal">
    <h2 id="modal-qty-title">Agregar</h2>
    <div class="form-group" style="margin-bottom:.85rem;">
      <label id="modal-qty-label">Cantidad</label>
      <input type="number" id="modal-qty-input" step="0.001" min="0.001" onkeydown="if(event.key==='Enter'){event.preventDefault(); event.stopPropagation(); confirmarAgregarCarrito();}">
    </div>
    <div id="modal-stock-info" style="font-size:.78rem;color:var(--muted);margin-bottom:.42rem;"></div>
    <div class="modal-actions">
      <button class="btn btn-secondary" onclick="cerrarModalQty()">Cancelar</button>
      <button class="btn btn-primary" onclick="confirmarAgregarCarrito()">Agregar â†µ</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="modal-venta">
  <div class="modal">
    <h2>âœ… Venta registrada</h2>
    <div id="resumen-venta"></div>
    <div class="info-tooltip">Presiona ENTER para cerrar y nueva venta.</div>
    <div class="modal-actions"><button class="btn btn-primary" onclick="cerrarModalVenta()">Nueva venta</button></div>
  </div>
</div>

<div class="modal-overlay" id="modal-np">
  <div class="modal">
    <h2>Producto no encontrado â€” Registrar</h2>
    <div class="form-grid">
      <div class="form-group"><label>CÃ³digo interno *</label><input type="text" id="np-codigo"></div>
      <div class="form-group"><label>Nombre *</label><input type="text" id="np-nombre"></div>
      <div class="form-group"><label>CÃ³digo de barras</label><input type="text" id="np-barcode" readonly style="background:var(--surface2);"></div>
      <div class="form-group"><label>Marca</label><input type="text" id="np-marca"></div>
      <div class="form-group"><label>Proveedor</label><select id="np-proveedor"></select></div>
      <div class="form-group"><label>Unidad</label><select id="np-unidad"><option value="unidad">Unidad</option><option value="kg">Kg</option><option value="100g">100g</option></select></div>
    </div>
    <div class="modal-actions"><button class="btn btn-secondary" onclick="document.getElementById('modal-np').classList.remove('open')">Cancelar</button><button class="btn btn-primary" onclick="guardarNuevoProd()">Registrar</button></div>
  </div>
</div>

<div class="modal-overlay" id="modal-edit-prod">
  <div class="modal">
    <h2>Editar producto</h2>
    <input type="hidden" id="ep-prod-id">
    <div class="form-grid">
      <div class="form-group"><label>CÃ³digo</label><input type="text" id="ep-prod-codigo"></div>
      <div class="form-group"><label>Nombre</label><input type="text" id="ep-prod-nombre"></div>
      <div class="form-group"><label>Unidad de medida</label><select id="ep-prod-unidad"><option value="unidad">Unidad</option><option value="kg">Kg</option><option value="100g">100g</option></select></div>
      <div class="form-group"><label>Marca</label><input type="text" id="ep-prod-marca"></div>
      <div class="form-group"><label>Stock MÃ­nimo</label><input type="number" id="ep-prod-min" step="0.001"></div>
      <div class="form-group"><label>Proveedor</label><select id="ep-prod-proveedor"></select></div>
    </div>
    <div class="modal-actions"><button class="btn btn-secondary" onclick="document.getElementById('modal-edit-prod').classList.remove('open')">Cancelar</button><button class="btn btn-primary" onclick="guardarEditProd()">Guardar cambios</button></div>
  </div>
</div>

<div class="modal-overlay" id="modal-edit-prov">
  <div class="modal">
    <h2>Editar Proveedor</h2>
    <input type="hidden" id="eprov-id">
    <div class="form-grid">
      <div class="form-group"><label>Nombre *</label><input type="text" id="eprov-nombre"></div>
      <div class="form-group"><label>Contacto</label><input type="text" id="eprov-contacto"></div>
      <div class="form-group"><label>TelÃ©fono</label><input type="text" id="eprov-tel"></div>
      <div class="form-group"><label>DÃ­as de Pedido</label><select id="eprov-dias-pedido" multiple style="height:70px;"><option value="1">Lunes</option><option value="2">Martes</option><option value="3">MiÃ©rcoles</option><option value="4">Jueves</option><option value="5">Viernes</option><option value="6">SÃ¡bado</option></select></div>
      <div class="form-group"><label>DÃ­as de Entrega</label><select id="eprov-dias-entrega" multiple style="height:70px;"><option value="1">Lunes</option><option value="2">Martes</option><option value="3">MiÃ©rcoles</option><option value="4">Jueves</option><option value="5">Viernes</option><option value="6">SÃ¡bado</option></select></div>
    </div>
    <div class="modal-actions"><button class="btn btn-secondary" onclick="document.getElementById('modal-edit-prov').classList.remove('open')">Cancelar</button><button class="btn btn-primary" onclick="guardarEditProv()">Guardar cambios</button></div>
  </div>
</div>

<div class="modal-overlay" id="modal-pago-deuda">
  <div class="modal">
    <h2>Pagar Deuda a Proveedor</h2>
    <input type="hidden" id="pd-id">
    <div class="form-grid">
      <div class="form-group"><label>Monto a pagar ahora ($)</label><input type="number" id="pd-monto" step="0.01"></div>
      <div class="form-group"><label>Desde cuenta</label><select id="pd-cuenta"></select></div>
    </div>
    <div class="modal-actions"><button class="btn btn-secondary" onclick="document.getElementById('modal-pago-deuda').classList.remove('open')">Cancelar</button><button class="btn btn-primary" onclick="confirmarPagoDeuda()">Registrar Pago</button></div>
  </div>
</div>

<div class="modal-overlay" id="modal-retiro-socio">
  <div class="modal">
    <h2>ğŸ“¦ Retiro de MercaderÃ­a por Socio</h2>
    <div class="form-grid">
      <div class="form-group"><label>Producto *</label><select id="rs-prod"></select></div>
      <div class="form-group"><label>Cantidad *</label><input type="number" id="rs-qty" step="0.001" min="0"></div>
      <div class="form-group"><label>Socio que retira *</label><select id="rs-socio"></select></div>
      <div class="form-group"><label>AsignaciÃ³n Contable *</label>
        <select id="rs-accion">
          <option value="descontar">Descontar del Saldo del Socio (Retiro)</option>
          <option value="perdida">PÃ©rdida/Gasto General del Negocio</option>
        </select>
      </div>
    </div>
    <div class="info-tooltip">Calcula el Costo (CMV) PEPS y se resta del saldo personal del socio (si se elige descontar).</div>
    <div class="modal-actions"><button class="btn btn-secondary" onclick="document.getElementById('modal-retiro-socio').classList.remove('open')">Cancelar</button><button class="btn btn-blue" onclick="confirmarRetiroSocio()">Registrar Salida</button></div>
  </div>
</div>

<div id="toast"></div>

<script src="app.js"></script>
</body>
</html>