<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://fonts.gstatic.com https://cdnjs.cloudflare.com data: blob:;">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LibrePOS - Gesti√≥n Almac√©n</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700;900&family=DM+Mono:wght@400;500&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<script src="chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>
<script src="node_modules/jsbarcode/dist/JsBarcode.all.min.js"></script>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<header>
  <div class="d-flex align-center">
    <img id="header-logo" class="header-logo" src="" alt="Logo">
    <h1 id="header-title">Libre<span>POS</span></h1>
  </div>
  <nav class="nav-tabs">
    <button class="nav-tab active" onclick="showSection('pos',this)">üõí POS</button>
    <button class="nav-tab" onclick="showSection('compras',this)">üì• Compras</button>
    <button class="nav-tab" id="tab-stock" onclick="showSection('stock',this)">üì¶ Stock</button>
    <button class="nav-tab" onclick="showSection('ventas',this)">üßæ Ventas</button>
    <button class="nav-tab" onclick="showSection('proveedores',this)">üöö Prov.</button>
    <button class="nav-tab" onclick="showSection('gastos',this)">üí∏ Gastos</button>
    <button class="nav-tab" onclick="showSection('finanzas',this)">üìà Finanzas</button>
    <button class="nav-tab" onclick="showSection('socios',this)">ü§ù Socios</button>
    <button class="nav-tab" onclick="showSection('clientes',this)">üë• Clientes</button>
    <button class="nav-tab" onclick="showSection('indicadores',this)">üìä Indicadores</button>
    <button class="nav-tab" onclick="showSection('informes',this)">üìÅ Informes</button>
    <button class="nav-tab" onclick="showSection('config',this)">‚öôÔ∏è Config</button>
  </nav>
</header>
<main>

<section class="section active" id="sec-pos">
  <div id="alertas-venc-pos"></div>
  <div class="pos-layout">
    <div class="d-flex-col gap-md">
      <div class="card pb-sm">
        <div class="caps-label">‚≠ê Combos y Promociones Activas</div>
        <div id="pos-promos-container" class="d-flex gap-sm scroll-x pb-sm">
           <span class="text-muted" style="font-size:.8rem;">No hay promociones activas. Cre√°las en el men√∫ Ventas.</span>
        </div>
      </div>

      <div class="card">
        <div class="barcode-wrap">
          <input type="text" id="pos-barcode" placeholder="Esperando c√≥digo... (o ENTER para confirmar venta)" oninput="handleBarcodeInput()" autofocus>
        </div>
        <div class="caps-label mb-sm">‚Üë Lectora de c√≥digo ¬∑ O busc√° por nombre:</div>
        <input type="text" id="pos-search" class="mb-sm" placeholder="Buscar por nombre o marca..." oninput="filterProducts()">
        <div class="product-grid" id="product-grid"></div>
      </div>
    </div>
    
    <div class="cart-panel">
      <div class="cart-header">üõí Venta actual</div>
      <div class="cart-items" id="cart-items"><div class="p-1 text-center text-muted">Seleccion√° productos</div></div>
      <div class="cart-footer">
        
        <div class="d-flex align-center gap-sm mb-sm p-sm bg-surface2">
          <input type="checkbox" id="cart-venta-costo" onchange="toggleCartCosto()"> 
          <label for="cart-venta-costo" style="margin:0; cursor:pointer; color:var(--text);">Aplicar Venta al Costo a todo el carrito</label>
        </div>
        
        <div class="caps-label" style="margin-bottom:.38rem;">Medio de pago</div>
        <div class="medios-pago" id="medios-pago-btns"></div>
        <div id="cart-desc-row" style="background:var(--green-light); border:1px solid var(--green); border-radius:5px; padding:.42rem .72rem; margin-bottom:.6rem; font-size:.78rem; display:none;" class="text-green"></div>
        
        <div class="alert-box">
            <div class="d-flex align-center gap-sm mb-sm">
                <input type="checkbox" id="chkCtaCte" onchange="document.getElementById('pos-cliente-wrap').style.display = this.checked ? 'block' : 'none'; uiActualizarTotalPOS();">
                <label for="chkCtaCte" class="text-accent" style="margin:0; cursor:pointer;">Vender a Cuenta Corriente (Fiado)</label>
            </div>
            <div id="pos-cliente-wrap" style="display: none;">
                <select id="pos-cliente" class="w-full mt-1"></select>
            </div>
        </div>
        
        <div class="dashed-divider d-flex-col gap-md">
            <div class="d-flex justify-between align-center">
                <span class="text-accent" style="font-size: .85rem;">Descuento manual ($)</span>
                <input type="number" id="pos-desc-manual" class="edit-inline" oninput="window.uiAplicarDescuentoManual()" placeholder="0.00" min="0">
            </div>

            <div class="d-flex justify-between align-center">
                <button id="btnRedondeo" class="btn btn-sm btn-secondary" onclick="uiAplicarRedondeo()">Redondear (Sug: $0)</button>
                <span id="lblDescuentoAplicado" class="mono text-accent">-$0.00</span>
            </div>

            <div class="d-flex justify-between align-center">
                <div class="d-flex align-center gap-sm">
                    <input type="checkbox" id="chkEnvio" onchange="uiActualizarTotalPOS()">
                    <label for="chkEnvio" style="margin:0; font-size:.85rem;">Env√≠o a dom.</label>
                </div>
                <input type="number" id="inputCostoEnvio" class="edit-inline" style="display:none; width:80px;" oninput="uiActualizarTotalPOS()" placeholder="Costo $">
            </div>
        </div>

        <div class="cart-totales">
          <div class="cart-total-row" id="cart-total-sin-desc-row" style="display:none;">
            <span class="caps-label" style="margin:0;">Sin descuento</span>
            <span class="mono text-muted" id="cart-total-sin-desc" style="font-size:1rem; text-decoration:line-through;"></span>
          </div>
          <div class="cart-total-row" style="border-top: 2px solid var(--text); padding-top: 10px; margin-top: 5px;">
            <span class="caps-label" id="cart-total-label" style="margin:0;">Total</span>
            <span class="cart-total-amount" id="cart-total">$0</span>
          </div>
        </div>
        
        <button class="btn btn-success w-full mt-1" style="font-size:.95rem; padding:.82rem;" onclick="confirmarVenta()">‚úÖ Confirmar Venta (Enter)</button>
        <button class="btn btn-danger w-full mt-1" onclick="limpiarCarrito()">üóëÔ∏è Cancelar Venta</button>
      </div>
    </div>
  </div>
</section>

<section class="section" id="sec-clientes">
  <div class="card">
    <div class="card-title">Nuevo Cliente (Cuenta Corriente)</div>
    <div class="form-grid">
      <div class="form-group"><label>Nombre / Raz√≥n Social *</label><input type="text" id="cli-nombre"></div>
      <div class="form-group"><label>Tel√©fono</label><input type="text" id="cli-tel"></div>
      <div class="form-group"><label>Direcci√≥n</label><input type="text" id="cli-dir"></div>
      <div class="form-group"><label>L√≠mite de Cr√©dito ($)</label><input type="number" id="cli-limite" step="1000" min="0" placeholder="0 = Ilimitado"></div>
    </div>
    <div class="info-tooltip">Establec√© un l√≠mite de cr√©dito para evitar que el cliente acumule una deuda mayor a la permitida. Dej√° en 0 para cr√©dito ilimitado.</div>
    <div class="mt-1"><button class="btn btn-primary" onclick="agregarCliente()">Agregar Cliente</button></div>
  </div>
  <div class="card">
    <div class="card-title">Directorio de Clientes y Estado de Cuentas</div>
    <div id="tabla-clientes-container"></div>
  </div>
</section>

<section class="section" id="sec-compras">
  <div class="card">
    <div class="card-title">1. Datos del Comprobante / Remito</div>
    <div class="form-grid">
      <div class="form-group"><label>Proveedor *</label><select id="comp-proveedor"></select></div>
      <div class="form-group"><label>N¬∫ Comprobante / Detalle</label><input type="text" id="comp-comprobante" placeholder="Ej: Factura A 0001-1234"></div>
      <div class="form-group"><label>Fecha *</label><input type="date" id="comp-fecha"></div>
      <div class="form-group"><label>Estado del Pago</label>
        <select id="comp-pago" onchange="togglePagoCompra(this.value)"><option value="pagado">Pagado ahora</option><option value="adeudado">A cuenta (Deuda)</option></select>
      </div>
      <div class="form-group" id="comp-cuenta-wrap"><label>Pagado desde cuenta</label><select id="comp-cuenta"></select></div>
    </div>
  </div>

  <div class="card">
    <div class="card-title">2. Agregar Productos al Comprobante</div>
    <div class="form-grid">
      <div class="form-group">
        <label>C√≥digo de barras / interno *</label>
        <div class="d-flex gap-sm">
          <input type="text" id="comp-barcode" placeholder="Escane√° o escrib√≠" onblur="buscarProdCompra()">
          <button class="btn btn-secondary" onclick="document.getElementById('comp-barcode').value = compras.generarCodigoInterno(); buscarProdCompra();" title="Generar c√≥digo interno autom√°tico">‚öôÔ∏è</button>
        </div>
      </div>
      <div class="form-group"><label>Producto (autocompletado)</label><input type="text" id="comp-prod-nombre" readonly class="bg-surface2" placeholder="‚Äî"><input type="hidden" id="comp-prod-id"></div>
      <div class="form-group"><label>Cantidad *</label><input type="number" id="comp-cantidad" step="0.001" min="0" placeholder="0"></div>
      <div class="form-group"><label>Costo unitario ($) *</label><input type="number" id="comp-costo" step="0.01" min="0" placeholder="0.00"></div>
      <div class="form-group"><label>Vencimiento</label><input type="date" id="comp-venc"></div>
    </div>
    
    <div class="mt-1 text-right">
      <button class="btn btn-secondary" onclick="agregarItemRemito()">+ A√±adir al listado</button>
    </div>

    <table class="mt-1">
      <thead><tr><th>C√≥digo</th><th>Producto</th><th>Cant.</th><th>Costo U.</th><th>Subtotal</th><th>Venc.</th><th></th></tr></thead>
      <tbody id="tabla-remito-items"></tbody>
    </table>

    <div class="dashed-divider d-flex justify-between align-center">
      <div style="font-size:1.2rem; font-weight:bold;">Total Remito: <span class="mono" id="comp-total-remito">$0.00</span></div>
      <button class="btn btn-primary" onclick="confirmarRemitoCompleto()">Registrar Compra y Actualizar Stock</button>
    </div>
  </div>
</section>

<section class="section" id="sec-stock">
  <div id="alertas-venc-stock"></div>
  <div class="card">
    <div class="card-title">Reglas de precios globales</div>
    <div class="d-flex align-end flex-wrap gap-md">
      <div class="form-group"><label>Descuento pago en Efectivo (%)</label><input type="number" id="cfg-desc-efectivo" step="0.5" min="0" max="50" placeholder="10" value="10"></div>
      <button class="btn btn-primary" onclick="guardarDescEfectivo()">Guardar regla</button>
    </div>
    <div class="info-tooltip">Se aplica en POS al elegir Efectivo. Productos con "Venta al Costo", "Promociones" o "‚àíDesc%" propio NO reciben este descuento extra.</div>
  </div>
  
  <div class="card">
    <div class="card-title">Cat√°logo ‚Äî Modificaci√≥n y Precios</div>
    
    <div class="d-flex align-center flex-wrap gap-sm mb-1">
      <input type="text" id="stock-search" placeholder="üîç Buscar por nombre, marca, c√≥digo..." oninput="renderTablaProductos()" class="flex-1" style="min-width:200px;">
      <select id="stock-sort" onchange="renderTablaProductos()" style="max-width:200px;">
         <option value="nombre">Ordenar por Nombre</option>
         <option value="venc">Ordenar por Vencimiento</option>
         <option value="prov">Ordenar por Proveedor</option>
      </select>
      <button class="btn btn-danger" onclick="abrirModalPreciosDesactualizados()">‚ö†Ô∏è Revisar Precios en G√≥ndola</button>
    </div>
    
    <div class="scroll-x">
    <table id="tabla-stock-cat">
      <thead><tr>
        <th>C√≥digo</th><th>Proveedor</th><th>Nombre</th><th>Unidad</th><th>Stock Min.</th><th>Stock Real</th>
        <th>Costo Alto</th><th>+Fijo$</th><th>+Imp%</th><th>+Gan%</th><th>-Desc%</th><th title="Ignora ganancia y descuento">Al Costo</th><th>Precio final</th><th>Acciones</th>
      </tr></thead>
      <tbody id="tabla-productos"></tbody>
    </table>
    </div>
    
    <div class="d-flex justify-between align-center flex-wrap mt-1 gap-sm">
      <div class="d-flex gap-sm">
        <button class="btn btn-secondary" onclick="abrirRetiroSocio()">üì¶ Retiro de Socios</button>
        <button class="btn btn-secondary" onclick="abrirModalMuestras()">üéÅ Muestras/Sorteos</button>
        <button class="btn btn-secondary" onclick="window.abrirModalAuditoria()">‚öñÔ∏è Auditor√≠a / Ajuste</button>
        <button class="btn btn-secondary" onclick="imprimirCodigosBarra()">üñ®Ô∏è C√≥digos de Barras</button>
      </div>
      <button class="btn btn-success" onclick="guardarPreciosTodos()">üíæ Guardar cambios de precios</button>
    </div>
  </div>
</section>

<section class="section" id="sec-ventas">
  <div class="tabs-row">
    <button class="tab-pill active" onclick="showVentTab('list',this)">Historial de Ventas</button>
    <button class="tab-pill" onclick="showVentTab('promo',this)">Combos y Promociones</button>
  </div>

  <div id="vent-list" class="vent-tab active">
    <div class="card">
      <div class="d-flex justify-between align-center flex-wrap mb-1">
        <div class="card-title" style="margin:0; border:none;">Listado de ventas</div>
        <button class="btn btn-primary btn-sm" onclick="window.abrirModalVentaHistorica()">‚è≥ + Cargar Venta Atrasada</button>
      </div>
      
      <div class="d-flex align-center flex-wrap gap-sm mb-1">
        <input type="date" id="vent-f-desde" style="max-width:150px;"> <input type="date" id="vent-f-hasta" style="max-width:150px;">
        <select id="vent-filtro-medio" style="max-width:165px;"><option value="">Todos los medios</option></select>
        <select id="vent-filtro-fact" style="max-width:165px;"><option value="">Todas</option><option value="si">Facturadas</option><option value="no">Sin facturar</option></select>
        <button class="btn btn-secondary btn-sm" onclick="renderTablaVentas()">Filtrar</button>
      </div>
      <table>
        <thead><tr><th>Fecha/Hora</th><th>Productos</th><th>Total</th><th>Desc. ef.</th><th>Medio</th><th>Facturada</th></tr></thead>
        <tbody id="tabla-ventas-menu"></tbody>
      </table>
      <div id="ventas-resumen-row" class="text-right p-sm mono font-bold"></div>
    </div>
  </div>

  <div id="vent-promo" class="vent-tab">
    <div class="card border-left-green">
      <div class="d-flex justify-between align-center">
          <div class="card-title" style="margin:0; border:none;">Mis Promociones Activas</div>
          <button class="btn btn-primary" onclick="window.abrirModalNuevaPromo()">+ Crear Promo Manual</button>
      </div>
      <div class="info-tooltip mt-1">Las promociones creadas aqu√≠ aparecer√°n como botones r√°pidos en la Caja Registradora (POS). No reciben el descuento general en efectivo.</div>
      <div id="lista-promos-activas" style="margin-top:1.5rem; display:grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap:1rem;"></div>
    </div>

    <div class="card">
      <div class="card-title">Sugerencias del Algoritmo (Market Basket Analysis)</div>
      <div class="info-tooltip">Calcula agrupaciones de productos que se venden juntos con frecuencia. Te sugiere un descuento garantizando una ganancia m√≠nima del 10%.</div>
      <div class="mt-1 mb-1">
         <button class="btn btn-primary" onclick="generarAnalisisPromociones()">Ejecutar An√°lisis y Mostrar Sugerencias</button>
      </div>
      <table>
        <thead><tr><th>Combinaci√≥n Sugerida</th><th>Ventas Conjuntas</th><th>Precio Recomendado</th><th></th></tr></thead>
        <tbody id="tabla-promociones"><tr><td colspan="4" class="text-center text-muted">Ejecut√° el an√°lisis para ver el Top 10.</td></tr></tbody>
      </table>
    </div>
  </div>
</section>

<section class="section" id="sec-proveedores">
  <div class="tabs-row">
    <button class="tab-pill active" onclick="showProvTab('list',this)">Directorio de Proveedores</button>
    <button class="tab-pill" onclick="showProvTab('deudas',this)">Cuentas por Pagar (Deudas)</button>
  </div>
  
  <div id="prov-list" class="prov-tab active">
    <div class="card">
      <div class="card-title">Nuevo proveedor</div>
      <div class="form-grid">
        <div class="form-group"><label>Nombre *</label><input type="text" id="prov-nombre"></div>
        <div class="form-group"><label>Contacto</label><input type="text" id="prov-contacto"></div>
        <div class="form-group"><label>Tel√©fono</label><input type="text" id="prov-tel"></div>
        <div class="form-group"><label>D√≠as de Pedido</label>
          <select id="prov-dias-pedido" multiple style="height:70px;"><option value="1">Lunes</option><option value="2">Martes</option><option value="3">Mi√©rcoles</option><option value="4">Jueves</option><option value="5">Viernes</option><option value="6">S√°bado</option></select>
        </div>
        <div class="form-group"><label>D√≠as de Entrega</label>
          <select id="prov-dias-entrega" multiple style="height:70px;"><option value="1">Lunes</option><option value="2">Martes</option><option value="3">Mi√©rcoles</option><option value="4">Jueves</option><option value="5">Viernes</option><option value="6">S√°bado</option></select>
        </div>
      </div>
      <div class="info-tooltip">Manten√© presionado CTRL (o CMD en Mac) para seleccionar varios d√≠as.</div>
      <div class="mt-1"><button class="btn btn-primary" onclick="agregarProveedor()">Agregar proveedor</button></div>
    </div>
    <div class="card"><div class="card-title">Proveedores registrados</div><div id="tabla-proveedores-container"></div></div>
  </div>

  <div id="prov-deudas" class="prov-tab">
    <div class="card">
      <div class="card-title">Registrar deuda manual a proveedor</div>
      <div class="form-grid">
        <div class="form-group"><label>Proveedor *</label><select id="deuda-prov"></select></div>
        <div class="form-group"><label>Fecha *</label><input type="date" id="deuda-fecha"></div>
        <div class="form-group"><label>Monto a deber ($) *</label><input type="number" id="deuda-monto" step="0.01" min="0"></div>
        <div class="form-group"><label>Descripci√≥n</label><input type="text" id="deuda-desc" placeholder="Ej: Saldo factura A-001"></div>
        <div class="form-group justify-end"><button class="btn btn-primary" onclick="registrarDeuda()">Registrar Deuda</button></div>
      </div>
    </div>
    <div class="card">
      <div class="card-title">Deudas Pendientes (Pasivos)</div>
      <table><thead><tr><th>Fecha</th><th>Proveedor</th><th>Descripci√≥n</th><th>Monto Original</th><th>Falta Pagar</th><th>Pagar Ahora</th></tr></thead>
      <tbody id="tabla-deudas"></tbody></table>
    </div>
  </div>
</section>

<section class="section" id="sec-gastos">
  <div class="card border-left-accent mb-1">
    <div class="card-title">Log√≠stica: Env√≠os Pendientes (Cadeter√≠a)</div>
    <div class="d-flex justify-between align-center flex-wrap gap-md">
       <div style="font-size:1.2rem; font-weight:bold;">Acumulado a pagar: <span id="envios-pendientes-total" class="mono text-accent">$0.00</span></div>
       <div class="d-flex align-center gap-sm">
          <select id="envios-cuenta"></select>
          <button class="btn btn-primary" onclick="pagarCadete()">Liquidar a Cadete</button>
       </div>
    </div>
  </div>

  <div class="card">
    <div class="card-title">Registrar gasto</div>
    <div class="form-grid">
      <div class="form-group"><label>Fecha *</label><input type="date" id="gasto-fecha"></div>
      <div class="form-group"><label>Categor√≠a *</label>
        <select id="gasto-cat"><option>Mercader√≠a no inventariable</option><option>Servicios (luz/gas)</option><option>Alquiler</option><option>Sueldos</option><option>Impuestos/Monotributo</option><option>Mantenimiento</option><option>Retiro Mercader√≠a</option><option>Otros</option></select>
      </div>
      <div class="form-group"><label>Tipo de Gasto</label>
        <select id="gasto-tipo"><option value="variable">Gasto Variable</option><option value="fijo">Gasto Fijo</option></select>
      </div>
      <div class="form-group"><label>Importe ($) *</label><input type="number" id="gasto-importe" step="0.01" min="0"></div>
      <div class="form-group"><label>Pagado desde cuenta *</label><select id="gasto-cuenta"></select></div>
      <div class="form-group"><label>Descripci√≥n</label><input type="text" id="gasto-desc"></div>
    </div>
    <div class="mt-1"><button class="btn btn-primary" onclick="registrarGasto()">Registrar gasto</button></div>
  </div>
  <div class="card">
    <div class="card-title">Historial de gastos</div>
    <table><thead><tr><th>Fecha</th><th>Categor√≠a</th><th>Tipo</th><th>Descripci√≥n</th><th>Importe</th><th>Cuenta</th><th></th></tr></thead>
    <tbody id="tabla-gastos"></tbody></table>
  </div>
</section>

<section class="section" id="sec-finanzas">
  <div class="stat-grid">
    <div class="stat-card"><div class="stat-label">Capital Propio</div><div class="stat-value" id="fin-capital">...</div><div class="stat-sub">Patrimonio Neto ‚àí Ganancias</div></div>
    <div class="stat-card" style="border-left-color:var(--green);"><div class="stat-label">Ganancia Sin Asignar</div><div class="stat-value text-green" id="fin-ganancia">...</div><div class="stat-sub">Disponible para reinvertir o asignar a socios</div></div>
    <div class="stat-card" style="border-left-color:var(--text);"><div class="stat-label">Liquidez Total</div><div class="stat-value" id="fin-liquidez">...</div><div class="stat-sub">Dinero real en todas las cuentas</div></div>
  </div>
  
  <div class="card">
    <div class="card-title">Cuentas y Medios de Pago (Ajuste de Caja)</div>
    <div class="info-tooltip mb-1">El <strong>Saldo Sistema</strong> se calcula autom√°ticamente. Si contaste la plata y hay diferencia, ingres√° el <strong>Saldo Real</strong> y ajust√° para crear un asiento autom√°tico.</div>
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1rem;" id="lista-cuentas"></div>
    <div class="dashed-divider">
      <h4 class="mb-sm">Crear nueva cuenta</h4>
      <div class="d-flex gap-sm">
        <input type="text" id="nueva-cta-nombre" placeholder="Ej: Banco Galicia" style="max-width:200px;">
        <input type="number" id="nueva-cta-saldo" placeholder="Saldo inicial ($)" style="max-width:150px;">
        <button class="btn btn-secondary" onclick="crearCuenta()">A√±adir Cuenta</button>
      </div>
    </div>
  </div>
  
  <div class="card">
    <div class="card-title">üîÑ Transferencia entre Cuentas</div>
    <div class="form-grid">
      <div class="form-group"><label>Cuenta de Origen *</label><select id="transf-origen"></select></div>
      <div class="form-group"><label>Cuenta de Destino *</label><select id="transf-destino"></select></div>
      <div class="form-group"><label>Monto a transferir ($) *</label><input type="number" id="transf-monto" step="0.01" min="0.01"></div>
      <div class="form-group"><label>Fecha *</label><input type="date" id="transf-fecha"></div>
    </div>
    <div class="mt-1">
      <button class="btn btn-success" onclick="registrarTransferencia()">Registrar Movimiento</button>
    </div>
  </div>

  <div class="card"><div class="card-title">Cashflow Semanal (√öltimos 30 d√≠as)</div><div class="chart-container"><canvas id="chart-cashflow"></canvas></div></div>
</section>

<section class="section" id="sec-socios">
  <div class="stat-grid">
    <div class="stat-card"><div class="stat-label">Ganancia Neta Global</div><div class="stat-value mono" id="soc-neta">...</div><div class="stat-sub">Rendimiento Hist√≥rico</div></div>
    <div class="stat-card" style="border-left-color:var(--amber);"><div class="stat-label">Ganancia Sin Asignar</div><div class="stat-value mono" style="color:var(--amber)" id="soc-disp">...</div><div class="stat-sub">Fondos libres de la empresa</div></div>
  </div>
  <div class="card">
    <div class="card-title">Socios y Cuentas Particulares</div>
    <div class="d-flex align-end gap-sm mb-1">
      <div class="form-group"><label>Nombre</label><input type="text" id="socio-nombre"></div>
      <div class="form-group"><label>DNI / CUIT</label><input type="text" id="socio-dni" placeholder="Sin puntos"></div>
      <button class="btn btn-primary" onclick="agregarSocio()">Crear Socio</button>
    </div>
    <div id="lista-socios"></div>
  </div>
  
  <div class="card">
    <div class="card-title">Operaciones de Socios (Libro Diario)</div>
    <div class="form-grid">
      <div class="form-group"><label>Socio *</label><select id="mov-socio"></select></div>
      <div class="form-group"><label>Operaci√≥n Contable *</label>
        <select id="mov-tipo" onchange="document.getElementById('mov-cuenta-wrap').style.display=(this.value==='asignacion'||this.value==='reinversion')?'none':'flex'">
          <option value="deposito">üì• Dep√≥sito de Capital</option>
          <option value="asignacion">üìä Asignar Ganancia</option>
          <option value="retiro">üì§ Retirar Fondos / Pr√©stamo</option>
          <option value="reinversion">‚ôªÔ∏è Reinvertir Utilidades</option>
        </select>
      </div>
      <div class="form-group"><label>Monto ($) *</label><input type="number" id="mov-importe" step="0.01"></div>
      <div class="form-group" id="mov-cuenta-wrap"><label>Cuenta Bancaria/Caja afectada</label><select id="mov-cuenta"></select></div>
      <div class="form-group"><label>Fecha</label><input type="date" id="mov-fecha"></div>
    </div>
    <div class="info-tooltip">Para <strong>Reinvertir utilidades</strong>, no es necesario seleccionar a un socio en particular.</div>
    <div class="mt-1"><button class="btn btn-primary" onclick="registrarMovimientoSocio()">Registrar Operaci√≥n</button></div>
  </div>
</section>

<section class="section" id="sec-indicadores">
  <div class="card"><div class="card-title">Dashboard Financiero y de Gesti√≥n</div><div class="stat-grid" id="dash-indicadores"></div></div>
</section>

<section class="section" id="sec-informes">
  <div id="informe-body">
    <div class="tabs-row mb-1">
      <button class="tab-pill active" onclick="showInfTab('resumen',this)">Resumen de Ventas</button>
      <button class="tab-pill" onclick="showInfTab('diario',this)">Libro Diario</button>
      <button class="tab-pill" onclick="showInfTab('vencimientos',this)">Pr√≥ximos Vencimientos</button>
    </div>
    
    <div id="inf-resumen" class="inf-tab active">
      <div class="mb-1 p-1 bg-surface2">
        <div class="form-group"><label>Desde</label><input type="date" id="inf-desde"></div>
        <div class="form-group"><label>Hasta</label><input type="date" id="inf-hasta"></div>
        <button class="btn btn-primary" onclick="generarInforme()">Generar informe de ventas</button>
        <button class="btn btn-secondary" onclick="generarListaPrecios()">üìÑ PDF Lista Precios</button>
        <button class="btn btn-secondary" onclick="generarPDFPedidos()">üì¶ PDF Pedidos</button>
      </div>
      <div class="stat-grid" id="stat-grid"></div>
      <div class="card"><div class="card-title">Detalle de ventas del per√≠odo</div>
        <table><thead><tr><th>Fecha</th><th>Productos</th><th>Costo (CMV)</th><th>Venta</th><th>Margen Bruto</th></tr></thead>
        <tbody id="tabla-inf-ventas"></tbody></table>
      </div>
    </div>
    
    <div id="inf-diario" class="inf-tab">
      <div class="card">
        <div class="card-title">Libro Diario General</div>
        <div class="info-tooltip mb-1">Nomenclatura patrimonial: <strong>(+A/-A)</strong> Activos, <strong>(+P/-P)</strong> Pasivos, <strong>(+PN/-PN)</strong> Patrimonio Neto, <strong>(+R+/-R-)</strong> Resultados.</div>
        <table><thead><tr><th>Fecha y Ref.</th><th>Cuentas Patrimoniales</th><th class="text-right">Debe</th><th class="text-right">Haber</th></tr></thead>
        <tbody id="tabla-diario"></tbody></table>
      </div>
    </div>

    <div id="inf-vencimientos" class="inf-tab">
      <div class="card">
        <div class="card-title">Reporte de Vencimientos</div>
        <div class="d-flex align-end flex-wrap gap-sm mb-1">
           <div class="form-group">
              <label>Mostrar productos que vencen en los pr√≥ximos:</label>
              <div class="d-flex align-center gap-sm">
                 <input type="number" id="venc-dias" value="30" step="1" min="1" style="width:80px;">
                 <span>d√≠as.</span>
              </div>
           </div>
           <button class="btn btn-primary" onclick="generarReporteVencimientos()">Generar Alerta</button>
        </div>
        <table>
          <thead><tr><th>Producto</th><th>Proveedor Reciente</th><th>Lote (Fecha Venc.)</th><th>Stock del Lote</th><th>D√≠as Restantes</th></tr></thead>
          <tbody id="tabla-inf-vencimientos"><tr><td colspan="5" class="text-center">Hac√© clic en Generar Alerta para analizar el inventario.</td></tr></tbody>
        </table>
      </div>
    </div>
  </div>
</section>

<section class="section" id="sec-config">
  <div class="card">
    <div class="card-title" style="border:none;">üè™ Datos del negocio</div>
    <div class="form-grid">
      <div class="form-group"><label>Nombre de fantas√≠a</label><input type="text" id="cfg-nombre"></div>
      <div class="form-group"><label>Direcci√≥n</label><input type="text" id="cfg-direccion"></div>
      <div class="form-group"><label>Tel√©fono</label><input type="text" id="cfg-tel"></div>
      <div class="form-group"><label>Email</label><input type="text" id="cfg-email"></div>
      <div class="form-group"><label>Instagram</label><input type="text" id="cfg-ig" placeholder="@usuario"></div>
      <div class="form-group"><label>Facebook</label><input type="text" id="cfg-fb" placeholder="/pagina"></div>
    </div>
    <div class="form-group mt-1" style="max-width:280px;">
      <label>Logo del negocio (Transparente)</label>
      <input type="file" id="cfg-logo-file" accept="image/*" onchange="cargarLogo(event)">
      <div id="cfg-logo-preview" class="mt-1"></div>
    </div>
    
    <div class="config-title" style="margin-top:1.5rem;">üé® Personalizaci√≥n de Colores</div>
<div class="form-grid" style="max-width:800px;">
    <div class="form-group"><label>Fondo General (Pantalla)</label><input type="color" id="cfg-bg" style="height:40px;padding:2px;"></div>
    <div class="form-group"><label>Fondo de Tarjetas (Paneles)</label><input type="color" id="cfg-surface" style="height:40px;padding:2px;"></div>
    <div class="form-group"><label>Fondo de Cabecera</label><input type="color" id="cfg-c2" style="height:40px;padding:2px;"></div>
    
    <div class="form-group"><label>Texto Principal</label><input type="color" id="cfg-text" style="height:40px;padding:2px;"></div>
    <div class="form-group"><label>Texto Secundario</label><input type="color" id="cfg-muted" style="height:40px;padding:2px;"></div>
    <div class="form-group"><label>Texto Cabecera y Men√∫</label><input type="color" id="cfg-h-text" style="height:40px;padding:2px;"></div>
    
    <div class="form-group"><label>Color Principal (Botones/Men√∫)</label><input type="color" id="cfg-c1" style="height:40px;padding:2px;"></div>
    <div class="form-group"><label>Texto de Botones Principales</label><input type="color" id="cfg-btn-text" style="height:40px;padding:2px;"></div>
    <div class="form-group"><label>Acci√≥n Positiva (Cobrar/Guardar)</label><input type="color" id="cfg-success" style="height:40px;padding:2px;"></div>
    <div class="form-group"><label>√ânfasis y Alertas (Borrar/Avisos)</label><input type="color" id="cfg-alert" style="height:40px;padding:2px;"></div>
</div>
<div style="margin-top: 1rem;">
    <button class="btn btn-secondary" onclick="window.restaurarColoresPorDefecto()">Restaurar Colores Originales</button>
</div>

    <div class="card-title mt-2" style="border:none;">üìÅ Almacenamiento (Base de Datos)</div>
    <div class="d-flex align-center gap-md mb-1">
      <button class="btn btn-secondary" onclick="elegirCarpetaGuardado()">üìÇ Seleccionar carpeta</button>
      <div id="ruta-guardado" class="mono text-muted" style="font-size:.8rem;">Guardando en memoria temporal (Navegador)</div>
    </div>
    
    <div class="mt-2"><button class="btn btn-primary" onclick="guardarConfig()">üíæ Guardar configuraci√≥n</button></div>
    
    <div class="dashed-divider">
      <button class="btn btn-primary" onclick="exportarDatos()">‚¨áÔ∏è Exportar copia (JSON)</button>
      <input type="file" id="import-file" accept=".json" onchange="importarDatos(event)" style="display:none;">
      <button class="btn btn-secondary" onclick="document.getElementById('import-file').click()">Importar copia (JSON)</button>
    </div>
    <div class="dashed-divider">
      <button class="btn btn-danger" onclick="if(confirm('¬øBorrar TODO el sistema? Esta acci√≥n es irreversible.')){localStorage.clear();location.reload();}">‚ö† Borrar todos los datos (Reset)</button>
    </div>
  </div>
</section>

</main>

<div class="modal-overlay" id="modal-qty">
  <div class="modal">
    <h2 id="modal-qty-title">Agregar</h2>
    <div class="form-group mb-1">
      <label id="modal-qty-label">Cantidad</label>
      <input type="number" id="modal-qty-input" step="0.001" min="0.001" onkeydown="if(event.key==='Enter'){event.preventDefault(); event.stopPropagation(); confirmarAgregarCarrito();}">
    </div>
    <div id="modal-stock-info" style="font-size:.78rem;color:var(--muted);margin-bottom:.42rem;"></div>
    <div class="modal-actions">
      <button class="btn btn-secondary" onclick="cerrarModalQty()">Cancelar</button>
      <button class="btn btn-primary" onclick="confirmarAgregarCarrito()">Agregar ‚Üµ</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="modal-promo">
  <div class="modal" style="max-width: 600px;">
    <h2>‚≠ê Armar Promoci√≥n / Combo</h2>
    <div class="info-tooltip">Agreg√° los productos que componen el combo. El sistema calcular√° el costo base y te permitir√° aplicar un porcentaje de descuento.</div>
    <div class="form-grid mt-1">
      <div class="form-group"><label>Nombre de la Promoci√≥n *</label><input type="text" id="promo-nombre" placeholder="Ej: Combo Desayuno"></div>
      <div class="form-group"><label>Descuento a aplicar (%) *</label><input type="number" id="promo-desc" step="1" min="0" max="100" value="15" oninput="window.calcularTotalesPromo()"></div>
    </div>
    <div class="mt-1 p-1 bg-surface2" style="border: 1px solid var(--border);">
      <h4 style="margin-top:0; margin-bottom:.5rem;">Productos incluidos en el combo</h4>
      <div class="d-flex gap-sm mb-1">
        <select id="promo-add-prod" class="flex-1"></select>
        <input type="number" id="promo-add-qty" value="1" min="1" step="0.001" style="width:80px;" placeholder="Cant.">
        <button class="btn btn-secondary" onclick="window.agregarProductoPromo()">A√±adir</button>
      </div>
      <table style="margin:0; font-size:.85rem;">
        <thead><tr><th>Producto</th><th>Cant.</th><th>Costo U.</th><th>Precio Normal</th><th></th></tr></thead>
        <tbody id="tabla-promo-items"></tbody>
      </table>
    </div>
    <div class="dashed-divider d-flex justify-between align-end">
        <div style="font-size:0.85rem; color:var(--muted); line-height: 1.5;">
            Costo Neto de Mercader√≠a: <strong id="promo-costo" class="mono">$0.00</strong><br>
            Suma Precio Venta Individual: <strong id="promo-normal" class="mono" style="text-decoration:line-through;">$0.00</strong>
        </div>
        <div class="text-right">
            <div class="caps-label text-accent" style="margin-bottom:3px;">Precio del Combo final al cliente</div>
            <div id="promo-final" class="mono text-green" style="font-size:1.8rem; font-weight:900; line-height:1;">$0.00</div>
        </div>
    </div>
    <div class="modal-actions mt-2">
      <button class="btn btn-secondary" onclick="document.getElementById('modal-promo').classList.remove('open')">Cancelar</button>
      <button class="btn btn-primary" onclick="window.guardarPromoManual()">Guardar Promoci√≥n</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="modal-venta">
  <div class="modal">
    <h2>‚úÖ Venta registrada</h2>
    <div id="resumen-venta"></div>
    <div class="info-tooltip">Presiona ENTER para cerrar y nueva venta.</div>
    <div class="modal-actions"><button class="btn btn-primary" onclick="cerrarModalVenta()">Nueva venta</button></div>
  </div>
</div>

<div class="modal-overlay" id="modal-np">
  <div class="modal">
    <h2>Producto no encontrado ‚Äî Registrar</h2>
    <div class="form-grid">
      <div class="form-group">
        <label>C√≥digo interno / Barras *</label>
        <div class="d-flex gap-sm">
            <input type="text" id="np-codigo">
            <button class="btn btn-secondary" onclick="document.getElementById('np-codigo').value = compras.generarCodigoInterno()" title="Generar c√≥digo interno autom√°tico">‚öôÔ∏è</button>
        </div>
      </div>
      <div class="form-group"><label>Nombre *</label><input type="text" id="np-nombre"></div>
      <div class="form-group"><label>Marca</label><input type="text" id="np-marca"></div>
      <div class="form-group"><label>Unidad</label><select id="np-unidad"><option value="unidad">Unidad</option><option value="kg">Kg</option><option value="100g">100g</option></select></div>
    </div>
    <div class="modal-actions"><button class="btn btn-secondary" onclick="document.getElementById('modal-np').classList.remove('open')">Cancelar</button><button class="btn btn-primary" onclick="guardarNuevoProd()">Registrar</button></div>
  </div>
</div>

<div class="modal-overlay" id="modal-edit-prod">
  <div class="modal">
    <h2>Editar producto</h2>
    <input type="hidden" id="ep-prod-id">
    <div class="form-grid">
      <div class="form-group"><label>C√≥digo</label><input type="text" id="ep-prod-codigo"></div>
      <div class="form-group"><label>Nombre</label><input type="text" id="ep-prod-nombre"></div>
      <div class="form-group"><label>Unidad de medida</label><select id="ep-prod-unidad"><option value="unidad">Unidad</option><option value="kg">Kg</option><option value="100g">100g</option></select></div>
      <div class="form-group"><label>Marca</label><input type="text" id="ep-prod-marca"></div>
      <div class="form-group"><label>Stock M√≠nimo</label><input type="number" id="ep-prod-min" step="0.001"></div>
    </div>
    <div class="modal-actions"><button class="btn btn-secondary" onclick="document.getElementById('modal-edit-prod').classList.remove('open')">Cancelar</button><button class="btn btn-primary" onclick="guardarEditProd()">Guardar cambios</button></div>
  </div>
</div>

<div class="modal-overlay" id="modal-edit-prov">
  <div class="modal">
    <h2>Editar Proveedor</h2>
    <input type="hidden" id="eprov-id">
    <div class="form-grid">
      <div class="form-group"><label>Nombre *</label><input type="text" id="eprov-nombre"></div>
      <div class="form-group"><label>Contacto</label><input type="text" id="eprov-contacto"></div>
      <div class="form-group"><label>Tel√©fono</label><input type="text" id="eprov-tel"></div>
      <div class="form-group"><label>D√≠as de Pedido</label><select id="eprov-dias-pedido" multiple style="height:70px;"><option value="1">Lunes</option><option value="2">Martes</option><option value="3">Mi√©rcoles</option><option value="4">Jueves</option><option value="5">Viernes</option><option value="6">S√°bado</option></select></div>
      <div class="form-group"><label>D√≠as de Entrega</label><select id="eprov-dias-entrega" multiple style="height:70px;"><option value="1">Lunes</option><option value="2">Martes</option><option value="3">Mi√©rcoles</option><option value="4">Jueves</option><option value="5">Viernes</option><option value="6">S√°bado</option></select></div>
    </div>
    <div class="modal-actions"><button class="btn btn-secondary" onclick="document.getElementById('modal-edit-prov').classList.remove('open')">Cancelar</button><button class="btn btn-primary" onclick="guardarEditProv()">Guardar cambios</button></div>
  </div>
</div>

<div class="modal-overlay" id="modal-pago-deuda">
  <div class="modal">
    <h2>Pagar Deuda a Proveedor</h2>
    <input type="hidden" id="pd-id">
    <div class="form-grid">
      <div class="form-group"><label>Monto a pagar ahora ($)</label><input type="number" id="pd-monto" step="0.01" value="0"></div>
      <div class="form-group"><label>Descuento obtenido ($)</label><input type="number" id="pd-descuento" step="0.01" value="0" placeholder="Ej: 500"></div>
      <div class="form-group"><label>Desde cuenta</label><select id="pd-cuenta"></select></div>
    </div>
    <div class="modal-actions"><button class="btn btn-secondary" onclick="document.getElementById('modal-pago-deuda').classList.remove('open')">Cancelar</button><button class="btn btn-primary" onclick="confirmarPagoDeuda()">Registrar Pago</button></div>
  </div>
</div>

<div class="modal-overlay" id="modal-retiro-socio">
  <div class="modal">
    <h2>üì¶ Retiro de Mercader√≠a por Socio</h2>
    <div class="form-grid">
      <div class="form-group"><label>Producto *</label><select id="rs-prod"></select></div>
      <div class="form-group"><label>Cantidad *</label><input type="number" id="rs-qty" step="0.001" min="0"></div>
      <div class="form-group"><label>Socio que retira *</label><select id="rs-socio"></select></div>
      <div class="form-group"><label>Asignaci√≥n Contable *</label>
        <select id="rs-accion">
          <option value="descontar">Descontar del Saldo del Socio</option>
          <option value="perdida">P√©rdida/Gasto General del Negocio</option>
        </select>
      </div>
    </div>
    <div class="info-tooltip">Calcula el Costo (CMV) PEPS y se resta del saldo personal del socio.</div>
    <div class="modal-actions"><button class="btn btn-secondary" onclick="document.getElementById('modal-retiro-socio').classList.remove('open')">Cancelar</button><button class="btn btn-success" onclick="confirmarRetiroSocio()">Registrar Salida</button></div>
  </div>
</div>

<div class="modal-overlay" id="modal-muestras">
  <div class="modal">
    <h2>üéÅ Registrar Muestra o Sorteo</h2>
    <div class="form-grid">
      <div class="form-group"><label>Producto *</label><select id="mu-prod"></select></div>
      <div class="form-group"><label>Cantidad *</label><input type="number" id="mu-qty" step="0.001" min="0"></div>
      <div class="form-group"><label>Fecha *</label><input type="date" id="mu-fecha"></div>
    </div>
    <div class="info-tooltip">Esta mercader√≠a se descontar√° del stock y se imputar√° autom√°ticamente como "Publicidad / Muestras".</div>
    <div class="modal-actions"><button class="btn btn-secondary" onclick="document.getElementById('modal-muestras').classList.remove('open')">Cancelar</button><button class="btn btn-success" onclick="confirmarMuestra()">Registrar Gasto</button></div>
  </div>
</div>

<div class="modal-overlay" id="modal-precios">
  <div class="modal" style="max-width:600px;">
    <h2>‚ö†Ô∏è Precios Desactualizados en G√≥ndola</h2>
    <div class="info-tooltip">Listado de productos con stock cuyo precio calculado actual difiere del √∫ltimo marcado.</div>
    <div style="max-height:300px; overflow-y:auto;">
      <table style="margin-bottom:0;">
        <thead><tr><th>Producto</th><th>Precio Anterior</th><th>Nuevo Sugerido</th><th>Acci√≥n</th></tr></thead>
        <tbody id="tabla-precios-desact"></tbody>
      </table>
    </div>
    <div class="modal-actions mt-1">
        <button class="btn btn-secondary" onclick="document.getElementById('modal-precios').classList.remove('open')">Cerrar</button>
        <button class="btn btn-primary" onclick="generarPDFEtiquetas()">Imprimir C√≥digos (PDF)</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="modal-edit-cliente">
  <div class="modal">
    <h2>Editar Cliente</h2>
    <input type="hidden" id="ecli-id">
    <div class="form-grid">
      <div class="form-group"><label>Nombre / Raz√≥n Social *</label><input type="text" id="ecli-nombre"></div>
      <div class="form-group"><label>Tel√©fono</label><input type="text" id="ecli-tel"></div>
      <div class="form-group"><label>Direcci√≥n</label><input type="text" id="ecli-dir"></div>
      <div class="form-group"><label>L√≠mite de Cr√©dito ($)</label><input type="number" id="ecli-limite" step="1000" min="0"></div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-secondary" onclick="document.getElementById('modal-edit-cliente').classList.remove('open')">Cancelar</button>
      <button class="btn btn-primary" onclick="guardarEditCliente()">Guardar cambios</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="modal-cobro-cliente">
  <div class="modal">
    <h2>Cobrar a Cuenta Corriente</h2>
    <input type="hidden" id="cobro-cli-id">
    <div class="form-grid">
      <div class="form-group"><label>Monto a cobrar ($) *</label><input type="number" id="cobro-monto" step="0.01" min="0.01"></div>
      <div class="form-group"><label>Fecha</label><input type="date" id="cobro-fecha"></div>
      <div class="form-group"><label>Ingresar fondos a *</label><select id="cobro-cuenta"></select></div>
      <div class="form-group"><label>Descripci√≥n</label><input type="text" id="cobro-desc"></div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-secondary" onclick="document.getElementById('modal-cobro-cliente').classList.remove('open')">Cancelar</button>
      <button class="btn btn-success" onclick="confirmarCobroCliente()">‚ûïRegistrar Cobro</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="modal-historial-cliente">
  <div class="modal" style="max-width: 600px;">
    <h2>Historial: <span id="historial-cli-nombre"></span></h2>
    <div class="mt-1" style="max-height: 400px; overflow-y: auto;">
      <table style="margin-bottom: 0;">
        <thead>
          <tr><th>Fecha</th><th>Descripci√≥n</th><th class="text-right">Cargos ($)</th><th class="text-right">Pagos ($)</th></tr>
        </thead>
        <tbody id="tabla-historial-cliente"></tbody>
      </table>
    </div>
    <div class="modal-actions mt-1">
      <button class="btn btn-secondary" onclick="document.getElementById('modal-historial-cliente').classList.remove('open')">Cerrar</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="modal-venta-historica">
  <div class="modal" style="max-width: 500px;">
    <h2>‚è≥ Cargar Ingreso Hist√≥rico</h2>
    <div class="info-tooltip">Registr√° el dinero total ingresado durante un corte de luz. El ajuste de stock y c√°lculo de costos se debe realizar luego mediante Auditor√≠a.</div>

    <div class="form-grid mt-1">
      <div class="form-group"><label>Fecha Exacta *</label><input type="date" id="vh-fecha"></div>
      <div class="form-group"><label>Hora Exacta *</label><input type="time" id="vh-hora"></div>
      <div class="form-group"><label>Monto Total ($) *</label><input type="number" id="vh-monto" step="0.01" min="0.01"></div>
      <div class="form-group"><label>Cobrado en Cuenta *</label><select id="vh-cuenta"></select></div>
      <div class="form-group"><label>Descripci√≥n</label><input type="text" id="vh-desc" placeholder="Ej: Ventas turno ma√±ana sin luz"></div>
    </div>

    <div class="modal-actions mt-2">
      <button class="btn btn-secondary" onclick="window.cerrarModalVentaHistorica()">Cancelar</button>
      <button class="btn btn-primary" onclick="window.confirmarVentaHistorica()">Registrar Ingreso</button>
    </div>
  </div>
</div>

<div class="modal-overlay" id="modal-auditoria">
  <div class="modal" style="max-width: 800px;">
    <h2>‚öñÔ∏è Auditor√≠a y Ajuste F√≠sico de Inventario</h2>
    <div class="info-tooltip">Cont√° cu√°ntos hay en la g√≥ndola y anot√° el Stock Real. Las diferencias negativas se registrar√°n autom√°ticamente como p√©rdidas en Gastos.</div>

    <div class="d-flex align-center gap-sm mt-1 mb-1">
      <input type="text" id="aud-search" placeholder="üîç Buscar producto o escanear..." oninput="window.filtrarAuditoria()" class="flex-1">
      <select id="aud-filtro" onchange="window.filtrarAuditoria()" style="width: 250px;">
        <option value="todos">Todos</option>
        <option value="diferencia">Solo con diferencias</option>
      </select>
    </div>

    <div style="max-height: 400px; overflow-y: auto; border: 1px solid var(--border); border-radius: 5px;">
      <table style="margin: 0;">
        <thead style="position: sticky; top: 0; background: var(--surface); z-index: 1;">
          <tr>
            <th>C√≥digo</th><th>Producto</th><th class="text-center">Stock Sistema</th><th class="text-center" style="width:130px;">Stock Real</th><th class="text-center">Diferencia</th>
          </tr>
        </thead>
        <tbody id="tabla-auditoria-items"></tbody>
      </table>
    </div>

    <div class="modal-actions mt-2">
      <button class="btn btn-secondary" onclick="window.cerrarModalAuditoria()">Cerrar / Cancelar</button>
      <button class="btn btn-primary" onclick="window.confirmarAuditoria()">Aplicar Ajustes F√≠sicos</button>
    </div>
  </div>
</div>
<div id="toast"></div>

<script src="app.js"></script>
</body>
</html>